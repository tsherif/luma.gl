(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{420:function(e,t,n){"use strict";n.r(t);var r=n(1),a=n.n(r),o=n(405),i=(n(2),n(35),n(0)),s=n.n(i),u=n(33),f=n(456),d=n(407),c=n(25),l=n(294),p=(n(64),n(54),n(78)),m=n(14),h=5126,v=5124,g=5125,E=function(){function e(e){var t;for(var n in this.layout={},this.size=0,e)this._addUniform(n,e[n]);this.size+=(4-this.size%4)%4;var r=new Float32Array(this.size);this.typedArray=((t={})[h]=r,t[v]=new Int32Array(r.buffer),t[g]=new Uint32Array(r.buffer),t)}var t=e.prototype;return t.getBytes=function(){return 4*this.size},t.getData=function(){return this.typedArray[h]},t.getSubData=function(e){var t,n;if(void 0===e)t=this.data,n=0;else{var r=this.offsets[e],a=r+this.sizes[e];t=this.data.subarray(r,a),n=4*r}return{data:t,offset:n}},t.setUniforms=function(e){for(var t in e)this._setValue(t,e[t]);return this},t._setValue=function(e,t){var n=this.layout[e];Object(m.a)(n,"UniformLayoutStd140 illegal argument");var r=this.typedArray[n.type];1===n.size?r[n.offset]=t:r.set(t,n.offset)},t._addUniform=function(e,t){var n=Object(p.a)(t);Object(m.a)(n,"UniformBufferLayout illegal argument");var r=n.type,a=n.components;this.size=this._alignTo(this.size,a);var o=this.size;this.size+=a,this.layout[e]={type:r,size:a,offset:o}},t._alignTo=function(e,t){switch(t){case 1:return e;case 2:return e+e%2;default:return e+(4-e%4)%4}},e}(),w=n(449),T=n(70),y=n(179),_=n(452),A=n(224),R=n(450),M=n(451),b=n(65);function D(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}var C=[1,1,0,-1,1,0,1,-1,0,-1,-1,0],x=2,F=3,O=2.8,B=new Float32Array(2),U=function(e){function t(t,n){var r,a=n.count,o=new Array(a),i=new Float32Array(16*a),s=new u.a(t,i.byteLength);return(r=e.call(this,t,Object.assign({geometry:new f.a},n,{vs:"#version 300 es\n#define SHADER_NAME scene.vs\n\nin vec3 positions;\nin vec3 normals;\nin vec2 texCoords;\nin vec4 modelMatCol1;\nin vec4 modelMatCol2;\nin vec4 modelMatCol3;\nin vec4 modelMatCol4;\n\nuniform mat4 uView;\nuniform mat4 uProjection;\nout vec3 vNormal;\nout vec2 vUV;\n\nvoid main(void) {\n  mat4 modelMat = mat4(\n    modelMatCol1,\n    modelMatCol2,\n    modelMatCol3,\n    modelMatCol4\n  );\n  gl_Position = uProjection * uView * modelMat * vec4(positions, 1.0);\n  vNormal = vec3(modelMat * vec4(normals, 0.0));\n  vUV = texCoords;\n}\n",fs:"#version 300 es\nprecision highp float;\n#define SHADER_NAME scene.fs\n\nin vec3 vNormal;\nin vec2 vUV;\nuniform sampler2D uTexture;\n\nout vec4 fragColor;\nvoid main(void) {\n  float d = clamp(dot(normalize(vNormal), normalize(vec3(1.0, 1.0, 0.2))), 0.0, 1.0);\n  fragColor.rgb = texture(uTexture, vUV).rgb * (d + 0.1);\n  fragColor.a = 1.0;\n}\n",isInstanced:1,instanceCount:a,uniforms:{uTexture:n.uniforms.uTexture},attributes:{modelMatCol1:{buffer:s,size:4,stride:64,offset:0,divisor:1},modelMatCol2:{buffer:s,size:4,stride:64,offset:16,divisor:1},modelMatCol3:{buffer:s,size:4,stride:64,offset:32,divisor:1},modelMatCol4:{buffer:s,size:4,stride:64,offset:48,divisor:1}}}))||this).count=a,r.xforms=o,r.matrices=i,r.matrixBuffer=s,r}return D(t,e),t.prototype.updateMatrixBuffer=function(){this.matrixBuffer.setData(this.matrices)},t}(d.a),P=function(e){function t(t){var n;return void 0===t&&(t={}),(n=e.call(this,t)||this).isDemoSupported=!0,n}D(t,e),t.getInfo=function(){return'\n<p>\n  <b>Depth of Field</b>.\n<p>\nSeveral instanced luma.gl <code>Cubes</code> rendered with a Depth of Field\npost-processing effect.\n\n<div>\n  Focal Length: <input type="range" id="focal-length" min="0.1" max="10.0" step="0.1">\n</div>\n<div>\n  Focus Distance: <input type="range" id="focus-distance" min="0.1" max="10.0" step="0.1">\n</div>\n<div>\n  F-Stop: <input type="range" id="f-stop" min="0.1" max="10.0" step="0.1">\n</div>\n\n'};var n=t.prototype;return n.onInitialize=function(e){var t,n,r,a,o=e.gl;e._animationLoop;if(this.isDemoSupported=Object(c.d)(o),!this.isDemoSupported)return{};Object(l.a)(o,{depthTest:!0,depthFunc:s.a.LEQUAL});var i=new M.a,f=(new M.a).lookAt({eye:[0,0,8]}),d=new E({uDepthRange:o.FLOAT_VEC2,uFocusDistance:o.FLOAT,uBlurCoefficient:o.FLOAT,uPPM:o.FLOAT}).setUniforms({uDepthRange:[.1,30]}),p=new u.a(o,{target:s.a.UNIFORM_BUFFER,data:d.getData(),accessor:{index:0}}),m=new w.a(o,{id:"DOF_PROGRAM",vs:"#version 300 es\n#define SHADER_NAME quad.vs\n\nlayout(location=0) in vec3 aPosition;\n\nvoid main() {\n    gl_Position = vec4(aPosition, 1.0);\n}\n",fs:"#version 300 es\nprecision highp float;\n#define SHADER_NAME dof.fs\n\n#define MAX_BLUR 20.0\n\nuniform DOFUniforms {\n  vec2  uDepthRange;\n  float uFocusDistance;\n  float uBlurCoefficient;\n  float uPPM;\n};\n\nuniform vec2 uTexelOffset;\n\nuniform sampler2D uColor;\nuniform sampler2D uDepth;\n\nout vec4 fragColor;\n\nvoid main() {\n    ivec2 fragCoord = ivec2(gl_FragCoord.xy);\n    ivec2 resolution = textureSize(uColor, 0) - 1;\n\n    // Convert to linear depth\n    float ndc = 2.0 * texelFetch(uDepth, fragCoord, 0).r - 1.0;\n    float depth = -(2.0 * uDepthRange.y * uDepthRange.x) / (ndc * (uDepthRange.y - uDepthRange.x) - uDepthRange.y - uDepthRange.x);\n    float deltaDepth = abs(uFocusDistance - depth);\n\n    // Blur more quickly in the foreground.\n    float xdd = depth < uFocusDistance ? abs(uFocusDistance - deltaDepth) : abs(uFocusDistance + deltaDepth);\n    float blurRadius = min(floor(uBlurCoefficient * (deltaDepth / xdd) * uPPM), MAX_BLUR);\n\n    vec4 color = vec4(0.0);\n    if (blurRadius > 1.0) {\n        float halfBlur = blurRadius * 0.5;\n\n        float count = 0.0;\n\n        for (float i = 0.0; i <= MAX_BLUR; ++i) {\n            if (i > blurRadius) {\n                break;\n            }\n\n            // texelFetch outside texture gives vec4(0.0) (undefined in ES 3)\n            ivec2 sampleCoord = clamp(fragCoord + ivec2(((i - halfBlur) * uTexelOffset)), ivec2(0), resolution);\n            color += texelFetch(uColor, sampleCoord, 0);\n\n            ++count;\n        }\n\n        color /= count;\n    } else {\n        color = texelFetch(uColor, fragCoord, 0);\n    }\n\n    fragColor = color;\n}\n"});m.uniformBlockBinding(m.getUniformBlockIndex("DOFUniforms"),0);var h=new T.a(o,{width:o.drawingBufferWidth,height:o.drawingBufferHeight,attachments:(r={},r[s.a.COLOR_ATTACHMENT0]=new y.a(o,{format:s.a.RGBA,type:s.a.UNSIGNED_BYTE,width:o.drawingBufferWidth,height:o.drawingBufferHeight,mipmaps:!1,parameters:(t={},t[s.a.TEXTURE_MIN_FILTER]=s.a.LINEAR,t[s.a.TEXTURE_MAG_FILTER]=s.a.LINEAR,t[s.a.TEXTURE_WRAP_S]=s.a.CLAMP_TO_EDGE,t[s.a.TEXTURE_WRAP_T]=s.a.CLAMP_TO_EDGE,t)}),r[s.a.DEPTH_ATTACHMENT]=new y.a(o,{format:s.a.DEPTH_COMPONENT16,type:s.a.UNSIGNED_SHORT,dataFormat:s.a.DEPTH_COMPONENT,width:o.drawingBufferWidth,height:o.drawingBufferHeight,mipmaps:!1,parameters:(n={},n[s.a.TEXTURE_MIN_FILTER]=s.a.NEAREST,n[s.a.TEXTURE_MAG_FILTER]=s.a.NEAREST,n[s.a.TEXTURE_WRAP_S]=s.a.CLAMP_TO_EDGE,n[s.a.TEXTURE_WRAP_T]=s.a.CLAMP_TO_EDGE,n)}),r)}),v=new T.a(o,{width:o.drawingBufferWidth,height:o.drawingBufferHeight,depth:!1}),g=document.getElementById("focal-length"),A=document.getElementById("focus-distance"),R=document.getElementById("f-stop");g&&(g.value=x,g.addEventListener("input",(function(){x=parseFloat(g.value)})),A.value=F,A.addEventListener("input",(function(){F=parseFloat(A.value)})),R.value=O,R.addEventListener("input",(function(){O=parseFloat(R.value)})));for(var b=new y.a(o,{data:"webgl-logo.png",mipmaps:!0,parameters:(a={},a[o.TEXTURE_MAG_FILTER]=o.LINEAR,a[o.TEXTURE_MIN_FILTER]=o.LINEAR_MIPMAP_NEAREST,a)}),D=new U(o,{count:100,uniforms:{uTexture:b}}),B=0,P=0;P<5;++P)for(var L=P-Math.floor(2.5),I=0;I<20;++I){var N=[.4,.4,.4],S=[-Math.random()*Math.PI,0,Math.random()*Math.PI],z=[2-I-L,0,2-I+L];D.xforms[B]={scale:N,translate:z,rotate:S,matrix:(new M.a).translate(z).rotateXYZ(S).scale(N)},D.matrices.set(D.xforms[B].matrix,16*B),++B}return D.updateMatrixBuffer(),{projMat:i,viewMat:f,instancedCubes:D,sceneFramebuffer:h,dofFramebuffer:v,quadVertexArray:new _.a(o,{program:m,attributes:{aPosition:new u.a(o,new Float32Array(C))}}),dofProgram:m,dofUniforms:p,dofUniformsLayout:d}},n.onRender=function(e){var t=e.gl,n=(e.tick,e.width,e.height,e.aspect),r=e.projMat,a=e.viewMat,o=e.instancedCubes,i=e.sceneFramebuffer,s=e.dofFramebuffer,u=e.quadVertexArray,f=e.dofProgram,d=e.dofUniforms,c=e.dofUniformsLayout;if(this.isDemoSupported){i.resize(t.drawingBufferWidth,t.drawingBufferHeight),s.resize(t.drawingBufferWidth,t.drawingBufferHeight);var l=x/Math.max(.1,Math.abs(F-x)),p=x*l/O,m=Math.sqrt(t.drawingBufferWidth*t.drawingBufferWidth+t.drawingBufferHeight*t.drawingBufferHeight)/35;Object(A.a)(t,{color:[0,0,0,1],depth:!0,framebuffer:i}),r.perspective({fov:Object(b.e)(75),aspect:n,near:.1,far:30}),a.lookAt({eye:[3,1.5,3],center:[0,0,0],up:[0,1,0]});for(var h=0;h<100;++h){var v=o.xforms[h];v.rotate[0]+=.01,v.rotate[1]+=.02,v.matrix.identity().translate(v.translate).rotateXYZ(v.rotate).scale(v.scale),o.matrices.set(v.matrix,16*h)}o.updateMatrixBuffer(),o.draw({uniforms:{uProjection:r,uView:a},framebuffer:i}),Object(A.a)(t,{color:[0,0,0,1],framebuffer:s}),B[0]=1,B[1]=0,c.setUniforms({uFocusDistance:F,uBlurCoefficient:p,uPPM:m}),d.setData(c.getData()),d.bind(),f.setUniforms({uTexelOffset:B,uColor:i.color,uDepth:i.depth}),f.draw({vertexArray:u,drawMode:t.TRIANGLE_STRIP,vertexCount:4,framebuffer:s}),Object(A.a)(t,{color:[0,0,0,1]}),B[0]=0,B[1]=1,f.setUniforms({uTexelOffset:B,uColor:i.color,uDepth:i.depth}),f.draw({vertexArray:u,drawMode:t.TRIANGLE_STRIP,vertexCount:4}),d.unbind()}},n.isSupported=function(){return this.isDemoSupported},n.getAltText=function(){return"THIS DEMO REQUIRES WEBLG2, BUT YOUR BROWSER DOESN'T SUPPORT IT"},t}(R.a);"undefined"==typeof window||window.website||(new P).start();n.d(t,"default",(function(){return L}));var L=function(e){var t,n;function r(){return e.apply(this,arguments)||this}return n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n,r.prototype.render=function(){return a.a.createElement(o.a,{AnimationLoop:P,exampleConfig:this.props.pageContext.exampleConfig})},r}(a.a.Component)},456:function(e,t,n){"use strict";n.d(t,"a",(function(){return d}));n(2),n(35),n(146);var r=n(406),a=n(131);var o=new Uint16Array([0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]),i=new Float32Array([-1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1,-1,1,1,1,1,1,1,1,-1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1]),s=new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0]),u=new Float32Array([0,0,1,0,1,1,0,1,1,0,1,1,0,1,0,0,0,1,0,0,1,0,1,1,1,1,0,1,0,0,1,0,1,0,1,1,0,1,0,0,0,0,1,0,1,1,0,1]),f={POSITION:{size:3,value:new Float32Array(i)},NORMAL:{size:3,value:new Float32Array(s)},TEXCOORD_0:{size:2,value:new Float32Array(u)}},d=function(e){var t,n;function r(t){void 0===t&&(t={});var n=t.id,r=void 0===n?Object(a.c)("cube-geometry"):n;return e.call(this,Object.assign({},t,{id:r,indices:{size:1,value:new Uint16Array(o)},attributes:Object.assign({},f,{},t.attributes)}))||this}return n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n,r}(r.a)}}]);
//# sourceMappingURL=component---templates-core-example-dof-jsx-855bae0bd66c63ee0a1e.js.map