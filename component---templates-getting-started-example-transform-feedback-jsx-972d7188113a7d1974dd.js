(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{LG3w:function(e,t,r){"use strict";r("91GP"),r("rE2o"),r("ioFf"),r("rGqo"),r("z2o2");var n=r("73Rc"),i=r.n(n),s=(r("Z2Ku"),r("L9s1"),r("pIFo"),r("KKXr"),r("ayeP")),a="void main() {gl_FragColor = vec4(0);}",u="out vec4 transform_output;\nvoid main() {\n  transform_output = vec4(0);\n}",o="#version 300 es\n"+u;function f(e,t){t=Array.isArray(t)?t:[t];var r=e.replace(/^\s+/,"").split(/\s+/),n=r[0],i=r[1],s=r[2];return t.includes(n)&&i&&s?{qualifier:n,type:i,name:s.split(";")[0]}:null}function c(e){var t=void 0===e?{}:e,r=t.version,n=void 0===r?100:r,i=t.input,f=t.inputType,c=t.output;if(!i)return 300===n?o:n>300?"#version "+n+"\n"+u:a;var d=function(e,t){switch(t){case"float":return"vec4("+e+", 0.0, 0.0, 1.0)";case"vec2":return"vec4("+e+", 0.0, 1.0)";case"vec3":return"vec4("+e+", 1.0)";case"vec4":return e;default:return Object(s.a)(!1),null}}(i,f);return n>=300?"#version "+n+" "+(300===n?"es":"")+"\nin "+f+" "+i+";\nout vec4 "+c+";\nvoid main() {\n  "+c+" = "+d+";\n}":"varying "+f+" "+i+";\nvoid main() {\n  gl_FragColor = "+d+";\n}"}r("yt8O"),r("Btvt"),r("RW0V");var d=r("lHlH"),l=r("3LCa"),h=r("GInI"),v=r("Iq2B"),g=function(){function e(e,t){void 0===t&&(t={}),this.gl=e,this.currentIndex=0,this.feedbackMap={},this.varyings=null,this.bindings=[],this.resources={},this._initialize(t),Object.seal(this)}var t=e.prototype;return t.setupResources=function(e){var t=this.bindings,r=Array.isArray(t),n=0;for(t=r?t:t[Symbol.iterator]();;){var i;if(r){if(n>=t.length)break;i=t[n++]}else{if((n=t.next()).done)break;i=n.value}var s=i;this._setupTransformFeedback(s,e)}},t.updateModelProps=function(e){void 0===e&&(e={});var t=this.varyings;return t.length>0&&(e=Object.assign({},e,{varyings:t})),e},t.getDrawOptions=function(e){void 0===e&&(e={});var t=this.bindings[this.currentIndex],r=t.sourceBuffers,n=t.transformFeedback;return{attributes:Object.assign({},r,e.attributes),transformFeedback:n}},t.swap=function(){return!!this.feedbackMap&&(this.currentIndex=this._getNextIndex(),!0)},t.update=function(e){void 0===e&&(e={}),this._setupBuffers(e)},t.getBuffer=function(e){var t=this.bindings[this.currentIndex].feedbackBuffers,r=e?t[e]:null;return r?r instanceof l.a?r:r.buffer:null},t.getData=function(e){var t=(void 0===e?{}:e).varyingName,r=this.getBuffer(t);return r?r.getData():null},t.delete=function(){for(var e in this.resources)this.resources[e].delete()},t._initialize=function(e){void 0===e&&(e={}),this._setupBuffers(e),this.varyings=e.varyings||Object.keys(this.bindings[this.currentIndex].feedbackBuffers),this.varyings.length>0&&Object(v.a)(Object(d.e)(this.gl))},t._getFeedbackBuffers=function(e){var t=e.sourceBuffers,r=void 0===t?{}:t,n={};if(this.bindings[this.currentIndex]&&Object.assign(n,this.bindings[this.currentIndex].feedbackBuffers),this.feedbackMap)for(var i in this.feedbackMap){var s=this.feedbackMap[i];i in r&&(n[s]=i)}for(var a in Object.assign(n,e.feedbackBuffers),n){var u=n[a];if("string"==typeof u){var o=r[u],f=o.byteLength,c=o.usage,d=o.accessor;n[a]=this._createNewBuffer(a,{byteLength:f,usage:c,accessor:d})}}return n},t._setupBuffers=function(e){void 0===e&&(e={});var t=e.sourceBuffers,r=void 0===t?null:t;Object.assign(this.feedbackMap,e.feedbackMap);var n=this._getFeedbackBuffers(e);this._updateBindings({sourceBuffers:r,feedbackBuffers:n})},t._setupTransformFeedback=function(e,t){var r=t.model.program;e.transformFeedback=new h.a(this.gl,{program:r,buffers:e.feedbackBuffers})},t._updateBindings=function(e){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],e),this.feedbackMap){var t=this._swapBuffers(this.bindings[this.currentIndex]),r=t.sourceBuffers,n=t.feedbackBuffers,i=this._getNextIndex();this.bindings[i]=this._updateBinding(this.bindings[i],{sourceBuffers:r,feedbackBuffers:n})}},t._updateBinding=function(e,t){return e?(Object.assign(e.sourceBuffers,t.sourceBuffers),Object.assign(e.feedbackBuffers,t.feedbackBuffers),e.transformFeedback&&e.transformFeedback.setBuffers(e.feedbackBuffers),e):{sourceBuffers:Object.assign({},t.sourceBuffers),feedbackBuffers:Object.assign({},t.feedbackBuffers)}},t._swapBuffers=function(e){if(!this.feedbackMap)return null;var t=Object.assign({},e.sourceBuffers),r=Object.assign({},e.feedbackBuffers);for(var n in this.feedbackMap){var i=this.feedbackMap[n];t[n]=e.feedbackBuffers[i],r[i]=e.sourceBuffers[n],Object(v.a)(r[i]instanceof l.a)}return{sourceBuffers:t,feedbackBuffers:r}},t._createNewBuffer=function(e,t){var r=new l.a(this.gl,t);return this.resources[e]&&this.resources[e].delete(),this.resources[e]=r,r},t._getNextIndex=function(){return(this.currentIndex+1)%2},e}(),p=(r("Y9lz"),r("EpVc")),x=r("2urO"),m=r("mECX"),b=r("kgJN");r("xfY5"),r("/KAi"),r("SRfc");function T(e){var t=100,r=e.match(/[^\s]+/g);if(r.length>=2&&"#version"===r[0]){var n=parseInt(r[1],10);Number.isFinite(n)&&(t=n)}return t}var _,y=r("63Iv"),B={name:"transform",vs:"attribute float transform_elementID;\n\n// returns half of pixel size, used to move the pixel position to center of the pixel.\nvec2 transform_getPixelSizeHalf(vec2 size) {\n  return vec2(1.) / (2. * size);\n}\n\n// returns current elements pixel indeces [x, y],\n// where x ranges in [0 to texSize-1] and y ranges in [0 to texSize-1]\nvec2 transform_getPixelIndices(vec2 texSize, vec2 pixelSizeHalf) {\n  // Add safe offset (half of pixel height) before doing floor\n  float yIndex = floor((transform_elementID / texSize[0]) + pixelSizeHalf[1]);\n  float xIndex = transform_elementID - (yIndex * texSize[0]);\n  return vec2(xIndex, yIndex);\n}\n\n// returns current elementID's texture co-ordianate\nvec2 transform_getTexCoord(vec2 size) {\n  vec2 pixelSizeHalf = transform_getPixelSizeHalf(size);\n  vec2 indices = transform_getPixelIndices(size, pixelSizeHalf);\n  vec2 coord = indices / size + pixelSizeHalf;\n  return coord;\n}\n\n// returns current elementID's position\nvec2 transform_getPos(vec2 size) {\n  vec2 texCoord = transform_getTexCoord(size);\n  // Change from [0 1] range to [-1 1]\n  vec2 pos = (texCoord * (2.0, 2.0)) - (1., 1.);\n  return pos;\n}\n\n// returns current elementID's pixel value\nvec4 transform_getInput(sampler2D texSampler, vec2 size) {\n  vec2 texCoord = transform_getTexCoord(size);\n  vec4 textureColor = texture2D(texSampler, texCoord);\n  return textureColor;\n}\n",fs:null},I=(r("f3/d"),"transform_uSampler_"),w="transform_uSize_",O="transform_position";function j(e){var t=e.vs,r=e.sourceTextureMap,n=e.targetTextureVarying,i=e.targetTexture,a=Object.keys(r).length,u=null,o={},c=t,d={};if(a>0||n){var l=c.split("\n"),h=l.slice();if(l.forEach((function(e,t,i){if(a>0){var c=function(e,t){var r={},n=function(e){return f(e,["attribute","in"])}(e);if(!n)return null;var i=n.type,a=n.name;if(a&&t[a]){var u="// "+e+" => Replaced by Transform with a sampler",o=function(e){var t=""+I+e,r=""+w+e;return{samplerName:t,sizeName:r,uniformDeclerations:"  uniform sampler2D "+t+";\n  uniform vec2 "+r+";"}}(a),c=o.samplerName,d=o.sizeName,l=o.uniformDeclerations,h=function(e){switch(e){case"float":return"x";case"vec2":return"xy";case"vec3":return"xyz";case"vec4":return"xyzw";default:return Object(s.a)(!1),null}}(i),v="  "+i+" "+a+" = transform_getInput("+c+", "+d+")."+h+";\n";return r[c]=a,{updatedLine:u,inject:{"vs:#decl":l,"vs:#main-start":v},samplerTextureMap:r}}return null}(e,r);if(c){var l=c.updatedLine,v=c.inject;h[t]=l,d=Object(y.b)([d,v]),Object.assign(o,c.samplerTextureMap),a--}}n&&!u&&(u=function(e,t){var r=f(e,["varying","out"]);if(!r)return null;return r.name===t?r.type:null}(e,n))})),n){Object(v.a)(i);var g=""+w+n,p={"vs:#decl":"uniform vec2 "+g+";\n","vs:#main-start":"     vec2 "+O+" = transform_getPos("+g+");\n     gl_Position = vec4("+O+", 0, 1.);\n"};d=Object(y.b)([d,p])}c=h.join("\n")}return{vs:c,targetTextureType:u,inject:d,samplerTextureMap:o}}var k=((_={})[i.a.TEXTURE_MIN_FILTER]=i.a.NEAREST,_[i.a.TEXTURE_MAG_FILTER]=i.a.NEAREST,_[i.a.TEXTURE_WRAP_S]=i.a.CLAMP_TO_EDGE,_[i.a.TEXTURE_WRAP_T]=i.a.CLAMP_TO_EDGE,_),S=function(){function e(e,t){void 0===t&&(t={}),this.gl=e,this.currentIndex=0,this._swapTexture=null,this.targetTextureVarying=null,this.targetTextureType=null,this.samplerTextureMap=null,this.bindings=[],this.resources={},this._initialize(t),Object.seal(this)}var t=e.prototype;return t.updateModelProps=function(e){void 0===e&&(e={});var t=this._processVertexShader(e);return Object.assign({},e,t)},t.getDrawOptions=function(e){void 0===e&&(e={});var t=this.bindings[this.currentIndex],r=t.sourceTextures,n=t.framebuffer,i=t.targetTexture,s=Object.assign({},e.attributes),a=Object.assign({},e.uniforms),u=Object.assign({},e.parameters),o=e.discard;if(this.hasSourceTextures||this.hasTargetTexture){for(var f in s.transform_elementID=this.elementIDBuffer,this.samplerTextureMap){var c=this.samplerTextureMap[f];a[f]=r[c]}this._setSourceTextureParameters();var d=function(e){var t,r,n=e.sourceTextureMap,i=e.targetTextureVarying,s=e.targetTexture,a={};for(var u in i&&(t=s.width,r=s.height,a[""+w+i]=[t,r]),n){var o=n[u];t=o.width,r=o.height,a[""+w+u]=[t,r]}return a}({sourceTextureMap:r,targetTextureVarying:this.targetTextureVarying,targetTexture:i});Object.assign(a,d)}return this.hasTargetTexture&&(o=!1,u.viewport=[0,0,n.width,n.height]),{attributes:s,framebuffer:n,uniforms:a,discard:o,parameters:u}},t.swap=function(){return!!this._swapTexture&&(this.currentIndex=this._getNextIndex(),!0)},t.update=function(e){void 0===e&&(e={}),this._setupTextures(e)},t.getTargetTexture=function(){return this.bindings[this.currentIndex].targetTexture},t.getData=function(e){var t=(void 0===e?{}:e).packed,r=void 0!==t&&t,n=this.bindings[this.currentIndex].framebuffer,i=Object(p.b)(n);if(!r)return i;for(var a=i.constructor,u=function(e){switch(e){case"float":return 1;case"vec2":return 2;case"vec3":return 3;case"vec4":return 4;default:return Object(s.a)(!1),null}}(this.targetTextureType),o=new a(i.length*u/4),f=0,c=0;c<i.length;c+=4)for(var d=0;d<u;d++)o[f++]=i[c+d];return o},t.getFramebuffer=function(){return this.bindings[this.currentIndex].framebuffer},t.delete=function(){this.ownTexture&&this.ownTexture.delete(),this.elementIDBuffer&&this.elementIDBuffer.delete()},t._initialize=function(e){void 0===e&&(e={});var t=e,r=t._targetTextureVarying,n=t._swapTexture;this._swapTexture=n,this.targetTextureVarying=r,this.hasTargetTexture=r,this._setupTextures(e)},t._createTargetTexture=function(e){var t=e.sourceTextures,r=e.textureOrReference;if(r instanceof x.a)return r;var n=t[r];return n?(this._targetRefTexName=r,this._createNewTexture(n)):null},t._setupTextures=function(e){void 0===e&&(e={});var t=e,r=t._sourceTextures,n=void 0===r?{}:r,i=t._targetTexture,s=this._createTargetTexture({sourceTextures:n,textureOrReference:i});this.hasSourceTextures=this.hasSourceTextures||n&&Object.keys(n).length>0,this._updateBindings({sourceTextures:n,targetTexture:s}),"elementCount"in e&&this._updateElementIDBuffer(e.elementCount)},t._updateElementIDBuffer=function(e){if(!("number"!=typeof e||this.elementCount>=e)){var t=new Float32Array(e);t.forEach((function(e,t,r){r[t]=t})),this.elementIDBuffer?this.elementIDBuffer.setData({data:t}):this.elementIDBuffer=new l.a(this.gl,{data:t,accessor:{size:1}}),this.elementCount=e}},t._updateBindings=function(e){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],e),this._swapTexture){var t=this._swapTextures(this.bindings[this.currentIndex]),r=t.sourceTextures,n=t.targetTexture,i=this._getNextIndex();this.bindings[i]=this._updateBinding(this.bindings[i],{sourceTextures:r,targetTexture:n})}},t._updateBinding=function(e,t){var r=t.sourceTextures,n=t.targetTexture;if(e||(e={sourceTextures:{},targetTexture:null}),Object.assign(e.sourceTextures,r),n){e.targetTexture=n;var s,a,u=n.width,o=n.height,f=e.framebuffer;if(f)f.update({attachments:(s={},s[i.a.COLOR_ATTACHMENT0]=n,s),resizeAttachments:!1}),f.resize({width:u,height:o});else e.framebuffer=new m.a(this.gl,{id:(this.id||"transform")+"-framebuffer",width:u,height:o,attachments:(a={},a[i.a.COLOR_ATTACHMENT0]=n,a)})}return e},t._setSourceTextureParameters=function(){var e=this.currentIndex,t=this.bindings[e].sourceTextures;for(var r in t)t[r].setParameters(k)},t._swapTextures=function(e){if(!this._swapTexture)return null;var t=Object.assign({},e.sourceTextures);return t[this._swapTexture]=e.targetTexture,{sourceTextures:t,targetTexture:e.sourceTextures[this._swapTexture]}},t._createNewTexture=function(e){var t,r,n=Object(b.a)(e,{parameters:(t={},t[i.a.TEXTURE_MIN_FILTER]=i.a.NEAREST,t[i.a.TEXTURE_MAG_FILTER]=i.a.NEAREST,t[i.a.TEXTURE_WRAP_S]=i.a.CLAMP_TO_EDGE,t[i.a.TEXTURE_WRAP_T]=i.a.CLAMP_TO_EDGE,t),pixelStore:(r={},r[i.a.UNPACK_FLIP_Y_WEBGL]=!1,r)});return this.ownTexture&&this.ownTexture.delete(),this.ownTexture=n,n},t._getNextIndex=function(){return(this.currentIndex+1)%2},t._processVertexShader=function(e){void 0===e&&(e={});var t=this.bindings[this.currentIndex],r=t.sourceTextures,n=t.targetTexture,i=j({vs:e.vs,sourceTextureMap:r,targetTextureVarying:this.targetTextureVarying,targetTexture:n}),s=i.vs,a=i.uniforms,u=i.targetTextureType,o=i.inject,f=i.samplerTextureMap,d=Object(y.b)([e.inject||{},o]);return this.targetTextureType=u,this.samplerTextureMap=f,{vs:s,fs:e._fs||c({version:T(s),input:this.targetTextureVarying,inputType:u,output:"transform_output"}),modules:this.hasSourceTextures||this.targetTextureVarying?[B].concat(e.modules||[]):e.modules,uniforms:a,inject:d}},e}(),E=r("BunF"),C=r("UD/Y");r.d(t,"a",(function(){return z}));var z=function(){function e(e,t){void 0===t&&(t={}),this.gl=e,this.model=null,this.elementCount=0,this.bufferTransform=null,this.textureTransform=null,this.elementIDBuffer=null,this._initialize(t),Object.seal(this)}e.isSupported=function(e){return Object(d.e)(e)};var t=e.prototype;return t.delete=function(){var e=this.model,t=this.bufferTransform,r=this.textureTransform;e&&e.delete(),t&&t.delete(),r&&r.delete()},t.run=function(e){void 0===e&&(e={});var t=e.clearRenderTarget,r=void 0===t||t,n=this._updateDrawOptions(e);r&&n.framebuffer&&n.framebuffer.clear({color:!0}),this.model.transform(n)},t.swap=function(){var e=!1,t=[this.bufferTransform,this.textureTransform].filter(Boolean),r=Array.isArray(t),n=0;for(t=r?t:t[Symbol.iterator]();;){var i;if(r){if(n>=t.length)break;i=t[n++]}else{if((n=t.next()).done)break;i=n.value}e=e||i.swap()}Object(v.a)(e,"Nothing to swap")},t.getBuffer=function(e){return void 0===e&&(e=null),this.bufferTransform&&this.bufferTransform.getBuffer(e)},t.getData=function(e){void 0===e&&(e={});var t=[this.bufferTransform,this.textureTransform].filter(Boolean),r=Array.isArray(t),n=0;for(t=r?t:t[Symbol.iterator]();;){var i;if(r){if(n>=t.length)break;i=t[n++]}else{if((n=t.next()).done)break;i=n.value}var s=i.getData(e);if(s)return s}return null},t.getFramebuffer=function(){return this.textureTransform&&this.textureTransform.getFramebuffer()},t.update=function(e){void 0===e&&(e={}),"elementCount"in e&&this.model.setVertexCount(e.elementCount);var t=[this.bufferTransform,this.textureTransform].filter(Boolean),r=Array.isArray(t),n=0;for(t=r?t:t[Symbol.iterator]();;){var i;if(r){if(n>=t.length)break;i=t[n++]}else{if((n=t.next()).done)break;i=n.value}i.update(e)}},t._initialize=function(e){void 0===e&&(e={});var t=this.gl;this._buildResourceTransforms(t,e),e=this._updateModelProps(e),this.model=new C.a(t,Object.assign({},e,{fs:e.fs||c({version:T(e.vs)}),id:e.id||"transform-model",drawMode:e.drawMode||i.a.POINTS,vertexCount:e.elementCount})),this.bufferTransform&&this.bufferTransform.setupResources({model:this.model})},t._updateModelProps=function(e){var t=Object.assign({},e),r=[this.bufferTransform,this.textureTransform].filter(Boolean),n=Array.isArray(r),i=0;for(r=n?r:r[Symbol.iterator]();;){var s;if(n){if(i>=r.length)break;s=r[i++]}else{if((i=r.next()).done)break;s=i.value}t=s.updateModelProps(t)}return t},t._buildResourceTransforms=function(e,t){(function(e){if(!Object(E.a)(e.sourceBuffers)||!Object(E.a)(e.feedbackBuffers)||e.varyings&&e.varyings.length>0)return!0;return!1})(t)&&(this.bufferTransform=new g(e,t)),function(e){if(!Object(E.a)(e._sourceTextures)||e._targetTexture||e._targetTextureVarying)return!0;return!1}(t)&&(this.textureTransform=new S(e,t)),Object(v.a)(this.bufferTransform||this.textureTransform,"must provide source/feedback buffers or source/target textures")},t._updateDrawOptions=function(e){var t=Object.assign({},e),r=[this.bufferTransform,this.textureTransform].filter(Boolean),n=Array.isArray(r),i=0;for(r=n?r:r[Symbol.iterator]();;){var s;if(n){if(i>=r.length)break;s=r[i++]}else{if((i=r.next()).done)break;s=i.value}var a=s;t=Object.assign(t,a.getDrawOptions(t))}return t},e}()},id9P:function(e,t,r){"use strict";r.r(t);var n=r("q1tI"),i=r.n(n),s=r("z0FI"),a=(r("Y9lz"),r("LG3w")),u=r("UD/Y"),o=r("bjw9"),f=r("3LCa"),c=r("IObG"),d=r("lHlH");var l=function(e){var t,r;function n(){return e.call(this,{debug:!0})||this}r=e,(t=n).prototype=Object.create(r.prototype),t.prototype.constructor=t,t.__proto__=r,n.getInfo=function(){return"\nAnimation via transform feedback.\n"};var i=n.prototype;return i.onInitialize=function(e){var t=e.gl;if(this.demoNotSupported=!Object(d.e)(t),this.demoNotSupported)return{};var r=new f.a(t,new Float32Array([-.5,-.5,.5,-.5,0,.5])),n=new a.a(t,{vs:"#version 300 es\n#define SIN2 0.03489949\n#define COS2 0.99939082\n\nin vec2 position;\n\nout vec2 vPosition;\nvoid main() {\n    mat2 rotation = mat2(\n        COS2, SIN2,\n        -SIN2, COS2\n    );\n    vPosition = rotation * position;\n}\n",sourceBuffers:{position:r},feedbackMap:{position:"vPosition"},elementCount:3}),i=new f.a(t,new Float32Array([1,0,0,0,1,0,0,0,1])),s=new u.a(t,{vs:"#version 300 es\n\nin vec2 position;\nin vec3 color;\n\nout vec3 vColor;\nvoid main() {\n    vColor = color;\n    gl_Position = vec4(position, 0.0, 1.0);\n}\n",fs:"#version 300 es\nprecision highp float;\n\nin vec3 vColor;\n\nout vec4 fragColor;\nvoid main() {\n    fragColor = vec4(vColor, 1.0);\n}\n",attributes:{position:n.getBuffer("vPosition"),color:i},vertexCount:3});return{transform:n,model:s}},i.onRender=function(e){var t=e.gl,r=e.transform,n=e.model;this.demoNotSupported||(r.run(),Object(c.a)(t,{color:[0,0,0,1]}),n.setAttributes({position:r.getBuffer("vPosition")}).draw(),r.swap())},i.onFinalize=function(e){var t=e.transform,r=e.model;t&&t.delete(),r&&r.delete()},i.getAltText=function(){return"THIS DEMO REQUIRES WEBGL 2, BUT YOUR BROWSER DOESN'T SUPPORT IT"},n}(o.a);"undefined"==typeof window||window.website||(new l).start();r.d(t,"default",(function(){return h}));var h=function(e){var t,r;function n(){return e.apply(this,arguments)||this}return r=e,(t=n).prototype=Object.create(r.prototype),t.prototype.constructor=t,t.__proto__=r,n.prototype.render=function(){var e=this.props.pageContext,t=e&&e.exampleConfig||{};return i.a.createElement(s.a,{AnimationLoop:l,exampleConfig:t})},n}(i.a.Component)}}]);
//# sourceMappingURL=component---templates-getting-started-example-transform-feedback-jsx-972d7188113a7d1974dd.js.map