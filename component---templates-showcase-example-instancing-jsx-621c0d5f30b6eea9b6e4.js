(window.webpackJsonp=window.webpackJsonp||[]).push([[20],{"75fp":function(i,e,n){"use strict";n.d(e,"a",(function(){return r}));n("rE2o"),n("ioFf"),n("FLlr"),n("xfY5"),n("rGqo"),n("yt8O"),n("Btvt"),n("XfO3"),n("9AAn");var t=1,o=1,r=function(){function i(){this.time=0,this.channels=new Map,this.animations=new Map,this.playing=!1,this.lastEngineTime=-1}var e=i.prototype;return e.addChannel=function(i){var e=i.delay,n=void 0===e?0:e,o=i.duration,r=void 0===o?Number.POSITIVE_INFINITY:o,a=i.rate,c=void 0===a?1:a,l=i.repeat,s=t++,u={time:0,delay:n,duration:r,rate:c,repeat:void 0===l?1:l};return this._setChannelTime(u,this.time),this.channels.set(s,u),s},e.removeChannel=function(i){this.channels.delete(i);var e=this.animations,n=Array.isArray(e),t=0;for(e=n?e:e[Symbol.iterator]();;){var o;if(n){if(t>=e.length)break;o=e[t++]}else{if((t=e.next()).done)break;o=t.value}var r=o,a=r[0];r[1].channel===i&&this.detachAnimation(a)}},e.isFinished=function(i){var e=this.channels.get(i);return void 0!==e&&this.time>=e.delay+e.duration*e.repeat},e.getTime=function(i){if(void 0===i)return this.time;var e=this.channels.get(i);return void 0===e?-1:e.time},e.setTime=function(i){this.time=Math.max(0,i);var e=this.channels.values(),n=Array.isArray(e),t=0;for(e=n?e:e[Symbol.iterator]();;){var o;if(n){if(t>=e.length)break;o=e[t++]}else{if((t=e.next()).done)break;o=t.value}var r=o;this._setChannelTime(r,this.time)}var a=this.animations.values(),c=Array.isArray(a),l=0;for(a=c?a:a[Symbol.iterator]();;){var s;if(c){if(l>=a.length)break;s=a[l++]}else{if((l=a.next()).done)break;s=l.value}var u=s,d=u.animation,v=u.channel;d.setTime(this.getTime(v))}},e.play=function(){this.playing=!0},e.pause=function(){this.playing=!1,this.lastEngineTime=-1},e.reset=function(){this.setTime(0)},e.attachAnimation=function(i,e){var n=o++;return this.animations.set(n,{animation:i,channel:e}),i.setTime(this.getTime(e)),n},e.detachAnimation=function(i){this.animations.delete(i)},e.update=function(i){this.playing&&(-1===this.lastEngineTime&&(this.lastEngineTime=i),this.setTime(this.time+(i-this.lastEngineTime)),this.lastEngineTime=i)},e._setChannelTime=function(i,e){var n=e-i.delay;n>=i.duration*i.repeat?i.time=i.duration*i.rate:(i.time=Math.max(0,n)%i.duration,i.time*=i.rate)},i}()},HGgG:function(i,e,n){"use strict";n.d(e,"a",(function(){return u}));n("91GP"),n("Y9lz"),n("r1bV");var t=n("PG+Z"),o=n("BunF");var r=new Uint16Array([0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]),a=new Float32Array([-1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1,-1,1,1,1,1,1,1,1,-1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1]),c=new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0]),l=new Float32Array([0,0,1,0,1,1,0,1,1,0,1,1,0,1,0,0,0,1,0,0,1,0,1,1,1,1,0,1,0,0,1,0,1,0,1,1,0,1,0,0,0,0,1,0,1,1,0,1]),s={POSITION:{size:3,value:new Float32Array(a)},NORMAL:{size:3,value:new Float32Array(c)},TEXCOORD_0:{size:2,value:new Float32Array(l)}},u=function(i){var e,n;function t(e){void 0===e&&(e={});var n=e.id,t=void 0===n?Object(o.c)("cube-geometry"):n;return i.call(this,Object.assign({},e,{id:t,indices:{size:1,value:new Uint16Array(r)},attributes:Object.assign({},s,{},e.attributes)}))||this}return n=i,(e=t).prototype=Object.create(n.prototype),e.prototype.constructor=e,e.__proto__=n,t}(t.a)},"PG+Z":function(i,e,n){"use strict";n.d(e,"a",(function(){return l}));n("xfY5"),n("/KAi"),n("91GP");var t=n("BunF"),o=n("Iq2B");function r(i,e){for(var n=0;n<e.length;n++){var t=e[n];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(i,t.key,t)}}function a(i,e,n){return e&&r(i.prototype,e),n&&r(i,n),i}var c={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},l=function(){function i(i){void 0===i&&(i={});var e=i,n=e.id,o=void 0===n?Object(t.c)("geometry"):n,r=e.drawMode,a=void 0===r?c.TRIANGLES:r,l=e.attributes,s=void 0===l?{}:l,u=e.indices,d=void 0===u?null:u,v=e.vertexCount,p=void 0===v?null:v;this.id=o,this.drawMode=0|a,this.attributes={},this.userData={},this._setAttributes(s,d),this.vertexCount=p||this._calculateVertexCount(this.attributes,this.indices)}a(i,null,[{key:"DRAW_MODE",get:function(){return c}}]);var e=i.prototype;return e.getVertexCount=function(){return this.vertexCount},e.getAttributes=function(){return this.indices?Object.assign({indices:this.indices},this.attributes):this.attributes},e._print=function(i){return"Geometry "+this.id+" attribute "+i},e._setAttributes=function(i,e){for(var n in e&&(this.indices=ArrayBuffer.isView(e)?{value:e,size:1}:e),i){var t=i[n];t=ArrayBuffer.isView(t)?{value:t}:t,Object(o.a)(ArrayBuffer.isView(t.value),this._print(n)+": must be typed array or object with value as typed array"),"POSITION"!==n&&"positions"!==n||t.size||(t.size=3),"indices"===n?(Object(o.a)(!this.indices),this.indices=t):this.attributes[n]=t}return this.indices&&void 0!==this.indices.isIndexed&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this},e._calculateVertexCount=function(i,e){if(e)return e.value.length;var n=1/0;for(var t in i){var r=i[t],a=r.value,c=r.size;!r.constant&&a&&c>=1&&(n=Math.min(n,a.length/c))}return Object(o.a)(Number.isFinite(n)),n},a(i,[{key:"mode",get:function(){return this.drawMode}}]),i}()},QJb2:function(i,e,n){"use strict";n("Y9lz");var t=n("WUN0"),o=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],r={modelMatrix:o,viewMatrix:o,projectionMatrix:o,cameraPositionWorld:[0,0,0]};var a={name:"project",getUniforms:function(i,e){void 0===i&&(i=r),void 0===e&&(e={});var n={};return void 0!==i.modelMatrix&&(n.modelMatrix=i.modelMatrix),void 0!==i.viewMatrix&&(n.viewMatrix=i.viewMatrix),void 0!==i.projectionMatrix&&(n.projectionMatrix=i.projectionMatrix),void 0!==i.cameraPositionWorld&&(n.cameraPositionWorld=i.cameraPositionWorld),void 0===i.projectionMatrix&&void 0===i.viewMatrix||(n.viewProjectionMatrix=new t.a(i.projectionMatrix).multiplyRight(i.viewMatrix)),n},vs:"varying vec4 project_vPositionWorld;\nvarying vec3 project_vNormalWorld;\n\nvec4 project_getPosition_World() {\n  return project_vPositionWorld;\n}\n\nvec3 project_getNormal_World() {\n  return project_vNormalWorld;\n}\n\n\n// Unprefixed uniforms\nuniform mat4 modelMatrix;\nuniform mat4 viewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 viewProjectionMatrix;\nuniform vec3 cameraPositionWorld;\n\nstruct World {\n  vec3 position;\n  vec3 normal;\n};\n\nWorld world;\n\nvoid project_setPosition(vec4 position) {\n  project_vPositionWorld = position;\n}\n\nvoid project_setNormal(vec3 normal) {\n  project_vNormalWorld = normal;\n}\n\nvoid project_setPositionAndNormal_World(vec3 position, vec3 normal) {\n  world.position = position;\n  world.normal = normal;\n}\n\nvoid project_setPositionAndNormal_Model(vec3 position, vec3 normal) {\n  world.position = (modelMatrix * vec4(position, 1.)).xyz;\n  world.normal = mat3(modelMatrix) * normal;\n}\n\nvec4 project_model_to_clipspace(vec4 position) {\n  return viewProjectionMatrix * modelMatrix * position;\n}\n\nvec4 project_model_to_clipspace(vec3 position) {\n  return viewProjectionMatrix * modelMatrix * vec4(position, 1.);\n}\n\nvec4 project_world_to_clipspace(vec3 position) {\n  return viewProjectionMatrix * vec4(position, 1.);\n}\n\nvec4 project_view_to_clipspace(vec3 position) {\n  return projectionMatrix * vec4(position, 1.);\n}\n\nvec4 project_to_clipspace(vec3 position) {\n  return viewProjectionMatrix * vec4(position, 1.);\n}\n",fs:"\nvarying vec4 project_vPositionWorld;\nvarying vec3 project_vNormalWorld;\n\nvec4 project_getPosition_World() {\n  return project_vPositionWorld;\n}\n\nvec3 project_getNormal_World() {\n  return project_vNormalWorld;\n}\n"},c={lightDirection:new Float32Array([1,1,2])};e.a={name:"dirlight",vs:null,fs:"uniform vec3 dirlight_uLightDirection;\n\n/*\n * Returns color attenuated by angle from light source\n */\nvec4 dirlight_filterColor(vec4 color) {\n  vec3 normal = project_getNormal_World();\n  float d = abs(dot(normalize(normal), normalize(dirlight_uLightDirection)));\n  return vec4(color.rgb * d, color.a);\n}\n",getUniforms:function(i){void 0===i&&(i=c);var e={};return i.lightDirection&&(e.dirlight_uLightDirection=i.lightDirection),e},dependencies:[a]}},U8Dg:function(i,e,n){"use strict";n("NO8f");var t={pickingSelectedColor:null,pickingHighlightColor:new Uint8Array([0,255,255,255]),pickingActive:!1,pickingAttribute:!1};e.a={name:"picking",vs:"uniform bool picking_uActive;\nuniform bool picking_uAttribute;\nuniform vec3 picking_uSelectedColor;\nuniform bool picking_uSelectedColorValid;\n\nout vec4 picking_vRGBcolor_Avalid;\n\nconst float COLOR_SCALE = 1. / 255.;\n\nbool picking_isColorValid(vec3 color) {\n  return dot(color, vec3(1.0)) > 0.001;\n}\n\nbool isVertexPicked(vec3 vertexColor) {\n  return\n    picking_uSelectedColorValid &&\n    !picking_isColorValid(abs(vertexColor - picking_uSelectedColor));\n}\n\nvoid picking_setPickingColor(vec3 pickingColor) {\n  if (picking_uActive) {\n    // Use alpha as the validity flag. If pickingColor is [0, 0, 0] fragment is non-pickable\n    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));\n\n    if (!picking_uAttribute) {\n      // Stores the picking color so that the fragment shader can render it during picking\n      picking_vRGBcolor_Avalid.rgb = pickingColor * COLOR_SCALE;\n    }\n  } else {\n    // Do the comparison with selected item color in vertex shader as it should mean fewer compares\n    picking_vRGBcolor_Avalid.a = float(isVertexPicked(pickingColor));\n  }\n}\n\nvoid picking_setPickingAttribute(float value) {\n  if (picking_uAttribute) {\n    picking_vRGBcolor_Avalid.r = value;\n  }\n}\nvoid picking_setPickingAttribute(vec2 value) {\n  if (picking_uAttribute) {\n    picking_vRGBcolor_Avalid.rg = value;\n  }\n}\nvoid picking_setPickingAttribute(vec3 value) {\n  if (picking_uAttribute) {\n    picking_vRGBcolor_Avalid.rgb = value;\n  }\n}\n",fs:"uniform bool picking_uActive;\nuniform vec3 picking_uSelectedColor;\nuniform vec4 picking_uHighlightColor;\n\nin vec4 picking_vRGBcolor_Avalid;\n\n/*\n * Returns highlight color if this item is selected.\n */\nvec4 picking_filterHighlightColor(vec4 color) {\n  if (picking_uActive) {\n    return color;\n  }\n  bool selected = bool(picking_vRGBcolor_Avalid.a);\n\n  if (selected) {\n    float highLightAlpha = picking_uHighlightColor.a;\n    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);\n    float highLightRatio = highLightAlpha / blendedAlpha;\n\n    vec3 blendedRGB = mix(color.rgb, picking_uHighlightColor.rgb, highLightRatio);\n    return vec4(blendedRGB, blendedAlpha);\n  } else {\n    return color;\n  }\n}\n\n/*\n * Returns picking color if picking enabled else unmodified argument.\n */\nvec4 picking_filterPickingColor(vec4 color) {\n  if (picking_uActive) {\n    if (picking_vRGBcolor_Avalid.a == 0.0) {\n      discard;\n    }\n    return picking_vRGBcolor_Avalid;\n  }\n  return color;\n}\n\n/*\n * Returns picking color if picking is enabled if not\n * highlight color if this item is selected, otherwise unmodified argument.\n */\nvec4 picking_filterColor(vec4 color) {\n  vec4 highightColor = picking_filterHighlightColor(color);\n  return picking_filterPickingColor(highightColor);\n}\n\n",getUniforms:function(i){void 0===i&&(i=t);var e={};if(void 0!==i.pickingSelectedColor)if(i.pickingSelectedColor){var n=i.pickingSelectedColor.slice(0,3);e.picking_uSelectedColorValid=1,e.picking_uSelectedColor=n}else e.picking_uSelectedColorValid=0;return i.pickingHighlightColor&&(e.picking_uHighlightColor=i.pickingHighlightColor.map((function(i){return i/255}))),void 0!==i.pickingActive&&(e.picking_uActive=Boolean(i.pickingActive),e.picking_uAttribute=Boolean(i.pickingAttribute)),e}}},rIz9:function(i,e,n){"use strict";n.r(e);var t=n("q1tI"),o=n.n(t),r=n("z0FI"),a=(n("aqI/"),n("Y9lz"),n("xfY5"),n("91GP"),n("DhAv")),c=n("HGgG"),l=n("UD/Y"),s=n("75fp"),u=n("bjw9"),d=n("3LCa"),v=n("EpVc"),p=n("lHlH"),g=n("U8Dg"),h=n("QJb2"),f=n("WUN0"),m=n("gmAo"),_=n("aI42");function b(i,e){i.prototype=Object.create(e.prototype),i.prototype.constructor=i,i.__proto__=e}var k=Object(_.b)(),C=Object.assign({inject:{"vs:MY_SHADER_HOOK_pickColor":"picking_setPickingColor(color.rgb);","fs:MY_SHADER_HOOK_fragmentColor":{injection:"color = picking_filterColor(color);",order:Number.POSITIVE_INFINITY}}},g.a),A=Object.assign({inject:{"fs:MY_SHADER_HOOK_fragmentColor":"color = dirlight_filterColor(color);"}},h.a),y=256,w=function(i){function e(e,n){for(var t=[],o=0;o<y;o++)for(var r=3*(1-y)/2+3*o,l=0;l<y;l++){var s=3*(1-y)/2+3*l;t.push(r,s)}t=new Float32Array(t);for(var u=new Uint8ClampedArray(y*y*2),v=0;v<y;v++)for(var p=0;p<y;p++)u[2*(v*y+p)+0]=v,u[2*(v*y+p)+1]=p;var g=new Float32Array(y*y*3).map((function(i,e){return.75*k()+.25})),h=new d.a(e,t),f=new d.a(e,g),m=new d.a(e,u),_=a.a.getDefaultProgramManager(e);return _.addShaderHook("vs:MY_SHADER_HOOK_pickColor(inout vec4 color)"),_.addShaderHook("fs:MY_SHADER_HOOK_fragmentColor(inout vec4 color)"),i.call(this,e,Object.assign({},n,{vs:"attribute float instanceSizes;\nattribute vec3 positions;\nattribute vec3 normals;\nattribute vec2 instanceOffsets;\nattribute vec3 instanceColors;\nattribute vec2 instancePickingColors;\n\nuniform mat4 uModel;\nuniform mat4 uView;\nuniform mat4 uProjection;\nuniform float uTime;\n\nvarying vec3 color;\n\nvoid main(void) {\n  vec3 normal = vec3(uModel * vec4(normals, 1.0));\n\n  // Set up data for modules\n  color = instanceColors;\n  project_setNormal(normal);\n  vec4 pickColor = vec4(0., instancePickingColors, 1.0);\n  MY_SHADER_HOOK_pickColor(pickColor);\n\n  // Vertex position (z coordinate undulates with time), and model rotates around center\n  float delta = length(instanceOffsets);\n  vec4 offset = vec4(instanceOffsets, sin((uTime + delta) * 0.1) * 16.0, 0);\n  gl_Position = uProjection * uView * (uModel * vec4(positions * instanceSizes, 1.0) + offset);\n}\n",fs:"precision highp float;\n\nvarying vec3 color;\n\nvoid main(void) {\n  gl_FragColor = vec4(color, 1.);\n  MY_SHADER_HOOK_fragmentColor(gl_FragColor);\n}\n",modules:[A,C],isInstanced:1,instanceCount:y*y,geometry:new c.a,attributes:{instanceSizes:new Float32Array([1]),instanceOffsets:[h,{divisor:1}],instanceColors:[f,{divisor:1}],instancePickingColors:[m,{divisor:1}]}}))||this}return b(e,i),e}(l.a),j=function(i){function e(){return i.call(this,{createFramebuffer:!0,debug:!0})||this}b(e,i),e.getInfo=function(){return"\n<p>\nCube drawn with <b>instanced rendering</b>.\n<p>\nA luma.gl <code>Cube</code>, rendering 65,536 instances in a\nsingle GPU draw call using instanced vertex attributes.\n"};var n=e.prototype;return n.onInitialize=function(i){var e=i.gl;i._animationLoop;Object(p.k)(e,{clearColor:[0,0,0,1],clearDepth:1,depthTest:!0,depthFunc:e.LEQUAL}),this.attachTimeline(new s.a),this.timeline.play();var n={timeChannel:this.timeline.addChannel({rate:.01}),eyeXChannel:this.timeline.addChannel({rate:3e-4}),eyeYChannel:this.timeline.addChannel({rate:4e-4}),eyeZChannel:this.timeline.addChannel({rate:2e-4})};return this.cube=new w(e),{timelineChannels:n}},n.onRender=function(i){var e=i.gl,n=i.aspect,t=i.tick,o=i.timelineChannels,r=i.framebuffer,a=i._mousePosition,c=o.timeChannel,l=o.eyeXChannel,s=o.eyeYChannel,u=o.eyeZChannel;if(a){var d=Object(p.b)(e,a);!function(i,e,n,t,o){o.clear({color:!0,depth:!0}),t.setUniforms({picking_uActive:1}),t.draw({framebuffer:o}),t.setUniforms({picking_uActive:0});var r=Object(v.b)(o,{sourceX:e,sourceY:n,sourceWidth:1,sourceHeight:1,sourceFormat:i.RGBA,sourceType:i.UNSIGNED_BYTE});r[0]+r[1]+r[2]>0?t.updateModuleSettings({pickingSelectedColor:r}):t.updateModuleSettings({pickingSelectedColor:null})}(e,d.x+Math.floor(d.width/2),d.y+Math.floor(d.height/2),this.cube,r)}e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),this.cube.setUniforms({uTime:this.timeline.getTime(c),uProjection:(new f.a).perspective({fov:Object(m.e)(60),aspect:n,near:1,far:2048}),uView:(new f.a).lookAt({center:[0,0,0],eye:[Math.cos(this.timeline.getTime(l))*y/2,Math.sin(this.timeline.getTime(s))*y/2,(Math.sin(this.timeline.getTime(u))+1)*y/4+32]}),uModel:(new f.a).rotateX(.01*t).rotateY(.013*t)}),this.cube.draw()},n.onFinalize=function(i){i.gl;this.cube.delete()},e}(u.a);"undefined"==typeof window||window.website||(new j).start();n.d(e,"default",(function(){return O}));var O=function(i){var e,n;function t(){return i.apply(this,arguments)||this}return n=i,(e=t).prototype=Object.create(n.prototype),e.prototype.constructor=e,e.__proto__=n,t.prototype.render=function(){var i=this.props.pageContext,e=i&&i.exampleConfig||{};return o.a.createElement(r.a,{AnimationLoop:j,exampleConfig:e})},t}(o.a.Component)}}]);
//# sourceMappingURL=component---templates-showcase-example-instancing-jsx-621c0d5f30b6eea9b6e4.js.map