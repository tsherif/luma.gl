{"version":3,"sources":["../../../src/glsl-to-js-compiler/debug-context.js"],"names":["DebugContext","sourceCanvas","container","offsetParent","containerStyle","window","getComputedStyle","position","style","canvas","_createCanvas","context","getContext","_draw","bind","opts","width","clientWidth","height","clientHeight","clearRect","name","model","Object","assign","draw","drawMode","indices","positions","colors","map","_clipspaceToScreen","_rgbaToColor","i","length","_drawPoint","_drawLine","_drawTriangle","Error","document","createElement","append","left","top","pointerEvents","x","y","z","w","depth","color","Array","isArray","rgb","slice","a","Number","isFinite","join","toFixed","p","fillStyle","fillRect","i0","i1","p0","p1","color0","color1","beginPath","gradient","createLinearGradient","addColorStop","strokeStyle","moveTo","lineTo","stroke","i2"],"mappings":"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","sourcesContent":["import GL from '@luma.gl/constants';\nimport drawModel from './draw-model';\n/* global document */\n\n/* Draws WebGL style wireframe in a 2d canvas */\nexport default class DebugContext {\n  constructor(sourceCanvas) {\n    this.sourceCanvas = sourceCanvas;\n\n    const container = sourceCanvas.offsetParent;\n    /* global window */\n    const containerStyle = window.getComputedStyle(container);\n    if (containerStyle.position === 'static') {\n      container.style.position = 'relative';\n    }\n\n    this.canvas = this._createCanvas(container);\n    this.context = this.canvas.getContext('2d');\n\n    this._draw = this._draw.bind(this);\n  }\n\n  clear(opts = {}) {\n    const {canvas, context} = this;\n    const {clientWidth: width, clientHeight: height} = this.sourceCanvas;\n\n    canvas.width = width;\n    canvas.height = height;\n    context.clearRect(0, 0, width, height);\n\n    for (const name in opts) {\n      context[name] = opts[name];\n    }\n  }\n\n  drawModel(model, opts) {\n    drawModel(\n      Object.assign({}, opts, {\n        model,\n        draw: this._draw\n      })\n    );\n  }\n\n  /* eslint-disable complexity */\n  _draw({drawMode, indices, positions, colors}) {\n    this.positions = positions.map(this._clipspaceToScreen, this);\n    this.colors = colors.map(this._rgbaToColor, this);\n\n    switch (drawMode) {\n      case GL.POINTS: {\n        for (let i = 0; i < indices.length; i++) {\n          this._drawPoint(indices[i]);\n        }\n        break;\n      }\n\n      case GL.LINES: {\n        for (let i = 0; i < indices.length - 1; i += 2) {\n          this._drawLine(indices[i], indices[i] + 1);\n        }\n        break;\n      }\n\n      case GL.LINE_STRIP: {\n        for (let i = 0; i < indices.length - 1; i++) {\n          this._drawLine(indices[i], indices[i + 1]);\n        }\n        break;\n      }\n\n      case GL.LINE_LOOP: {\n        for (let i = 0; i < indices.length; i++) {\n          this._drawLine(i === 0 ? indices[indices.length - 1] : indices[i - 1], indices[i]);\n        }\n        break;\n      }\n\n      case GL.TRIANGLES: {\n        for (let i = 0; i < indices.length - 2; i += 3) {\n          this._drawTriangle(indices[i], indices[i + 1], indices[i + 2]);\n        }\n        break;\n      }\n\n      case GL.TRIANGLE_STRIP: {\n        for (let i = 0; i < indices.length - 2; i++) {\n          this._drawTriangle(indices[i], indices[i + 1], indices[i + 2]);\n        }\n        break;\n      }\n\n      case GL.TRIANGLE_FAN: {\n        for (let i = 1; i < indices.length - 1; i++) {\n          this._drawTriangle(indices[0], indices[i], indices[i + 1]);\n        }\n        break;\n      }\n\n      default:\n        throw new Error('unknown draw mode');\n    }\n  }\n  /* eslint-enable complexity */\n\n  _createCanvas(container) {\n    const canvas = document.createElement('canvas');\n    container.append(canvas);\n    Object.assign(canvas.style, {\n      position: 'absolute',\n      left: '0px',\n      top: '0px',\n      pointerEvents: 'none'\n    });\n    return canvas;\n  }\n\n  _clipspaceToScreen(position) {\n    const {width, height} = this.canvas;\n    const [x, y, z, w] = position;\n\n    const depth = z / w;\n\n    if (depth < -1 || depth > 1) {\n      return null;\n    }\n\n    return [((x / w + 1) * width) / 2, ((1 - y / w) * height) / 2];\n  }\n\n  _rgbaToColor(color) {\n    if (Array.isArray(color)) {\n      const rgb = color.slice(0, 3).map(x => (x * 255) | 0);\n      const a = Number.isFinite(color[3]) ? color[3] : 1;\n      return `rgba(${rgb.join(',')},${a.toFixed(2)})`;\n    }\n    return color;\n  }\n\n  _drawPoint(i) {\n    const {context, positions, colors} = this;\n    const p = positions[i];\n    const color = colors[i];\n\n    if (!p) {\n      return;\n    }\n    if (color) {\n      context.fillStyle = color;\n    }\n    context.fillRect(p[0] - 0.5, p[1] - 0.5, 1, 1);\n  }\n\n  _drawLine(i0, i1) {\n    const {context, positions, colors} = this;\n    const p0 = positions[i0];\n    const p1 = positions[i1];\n    const color0 = colors[i0];\n    const color1 = colors[i1];\n\n    if (!p0 || !p1) {\n      return;\n    }\n\n    context.beginPath();\n    if (color0 !== color1) {\n      // Use gradient\n      const gradient = context.createLinearGradient(p0[0], p0[1], p1[0], p1[1]);\n      gradient.addColorStop(0, color0);\n      gradient.addColorStop(1, color1);\n\n      context.strokeStyle = gradient;\n    } else if (color0) {\n      // Single color\n      context.strokeStyle = color0;\n    }\n\n    context.moveTo(p0[0], p0[1]);\n    context.lineTo(p1[0], p1[1]);\n    context.stroke();\n  }\n\n  _drawTriangle(i0, i1, i2) {\n    this._drawLine(i0, i1);\n    this._drawLine(i1, i2);\n    this._drawLine(i2, i0);\n  }\n}\n"],"file":"debug-context.js"}