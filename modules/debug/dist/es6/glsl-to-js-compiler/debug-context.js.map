{"version":3,"sources":["../../../src/glsl-to-js-compiler/debug-context.js"],"names":["drawModel","DebugContext","constructor","sourceCanvas","container","offsetParent","containerStyle","window","getComputedStyle","position","style","canvas","_createCanvas","context","getContext","_draw","bind","clear","opts","width","clientWidth","height","clientHeight","clearRect","name","model","Object","assign","draw","drawMode","indices","positions","colors","map","_clipspaceToScreen","_rgbaToColor","i","length","_drawPoint","_drawLine","_drawTriangle","Error","document","createElement","append","left","top","pointerEvents","x","y","z","w","depth","color","Array","isArray","rgb","slice","a","Number","isFinite","join","toFixed","p","fillStyle","fillRect","i0","i1","p0","p1","color0","color1","beginPath","gradient","createLinearGradient","addColorStop","strokeStyle","moveTo","lineTo","stroke","i2"],"mappings":"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","sourcesContent":["import GL from '@luma.gl/constants';\nimport drawModel from './draw-model';\n/* global document */\n\n/* Draws WebGL style wireframe in a 2d canvas */\nexport default class DebugContext {\n  constructor(sourceCanvas) {\n    this.sourceCanvas = sourceCanvas;\n\n    const container = sourceCanvas.offsetParent;\n    /* global window */\n    const containerStyle = window.getComputedStyle(container);\n    if (containerStyle.position === 'static') {\n      container.style.position = 'relative';\n    }\n\n    this.canvas = this._createCanvas(container);\n    this.context = this.canvas.getContext('2d');\n\n    this._draw = this._draw.bind(this);\n  }\n\n  clear(opts = {}) {\n    const {canvas, context} = this;\n    const {clientWidth: width, clientHeight: height} = this.sourceCanvas;\n\n    canvas.width = width;\n    canvas.height = height;\n    context.clearRect(0, 0, width, height);\n\n    for (const name in opts) {\n      context[name] = opts[name];\n    }\n  }\n\n  drawModel(model, opts) {\n    drawModel(\n      Object.assign({}, opts, {\n        model,\n        draw: this._draw\n      })\n    );\n  }\n\n  /* eslint-disable complexity */\n  _draw({drawMode, indices, positions, colors}) {\n    this.positions = positions.map(this._clipspaceToScreen, this);\n    this.colors = colors.map(this._rgbaToColor, this);\n\n    switch (drawMode) {\n      case GL.POINTS: {\n        for (let i = 0; i < indices.length; i++) {\n          this._drawPoint(indices[i]);\n        }\n        break;\n      }\n\n      case GL.LINES: {\n        for (let i = 0; i < indices.length - 1; i += 2) {\n          this._drawLine(indices[i], indices[i] + 1);\n        }\n        break;\n      }\n\n      case GL.LINE_STRIP: {\n        for (let i = 0; i < indices.length - 1; i++) {\n          this._drawLine(indices[i], indices[i + 1]);\n        }\n        break;\n      }\n\n      case GL.LINE_LOOP: {\n        for (let i = 0; i < indices.length; i++) {\n          this._drawLine(i === 0 ? indices[indices.length - 1] : indices[i - 1], indices[i]);\n        }\n        break;\n      }\n\n      case GL.TRIANGLES: {\n        for (let i = 0; i < indices.length - 2; i += 3) {\n          this._drawTriangle(indices[i], indices[i + 1], indices[i + 2]);\n        }\n        break;\n      }\n\n      case GL.TRIANGLE_STRIP: {\n        for (let i = 0; i < indices.length - 2; i++) {\n          this._drawTriangle(indices[i], indices[i + 1], indices[i + 2]);\n        }\n        break;\n      }\n\n      case GL.TRIANGLE_FAN: {\n        for (let i = 1; i < indices.length - 1; i++) {\n          this._drawTriangle(indices[0], indices[i], indices[i + 1]);\n        }\n        break;\n      }\n\n      default:\n        throw new Error('unknown draw mode');\n    }\n  }\n  /* eslint-enable complexity */\n\n  _createCanvas(container) {\n    const canvas = document.createElement('canvas');\n    container.append(canvas);\n    Object.assign(canvas.style, {\n      position: 'absolute',\n      left: '0px',\n      top: '0px',\n      pointerEvents: 'none'\n    });\n    return canvas;\n  }\n\n  _clipspaceToScreen(position) {\n    const {width, height} = this.canvas;\n    const [x, y, z, w] = position;\n\n    const depth = z / w;\n\n    if (depth < -1 || depth > 1) {\n      return null;\n    }\n\n    return [((x / w + 1) * width) / 2, ((1 - y / w) * height) / 2];\n  }\n\n  _rgbaToColor(color) {\n    if (Array.isArray(color)) {\n      const rgb = color.slice(0, 3).map(x => (x * 255) | 0);\n      const a = Number.isFinite(color[3]) ? color[3] : 1;\n      return `rgba(${rgb.join(',')},${a.toFixed(2)})`;\n    }\n    return color;\n  }\n\n  _drawPoint(i) {\n    const {context, positions, colors} = this;\n    const p = positions[i];\n    const color = colors[i];\n\n    if (!p) {\n      return;\n    }\n    if (color) {\n      context.fillStyle = color;\n    }\n    context.fillRect(p[0] - 0.5, p[1] - 0.5, 1, 1);\n  }\n\n  _drawLine(i0, i1) {\n    const {context, positions, colors} = this;\n    const p0 = positions[i0];\n    const p1 = positions[i1];\n    const color0 = colors[i0];\n    const color1 = colors[i1];\n\n    if (!p0 || !p1) {\n      return;\n    }\n\n    context.beginPath();\n    if (color0 !== color1) {\n      // Use gradient\n      const gradient = context.createLinearGradient(p0[0], p0[1], p1[0], p1[1]);\n      gradient.addColorStop(0, color0);\n      gradient.addColorStop(1, color1);\n\n      context.strokeStyle = gradient;\n    } else if (color0) {\n      // Single color\n      context.strokeStyle = color0;\n    }\n\n    context.moveTo(p0[0], p0[1]);\n    context.lineTo(p1[0], p1[1]);\n    context.stroke();\n  }\n\n  _drawTriangle(i0, i1, i2) {\n    this._drawLine(i0, i1);\n    this._drawLine(i1, i2);\n    this._drawLine(i2, i0);\n  }\n}\n"],"file":"debug-context.js"}