{"version":3,"sources":["../../../src/passes/convolution-pass.js"],"names":["_Pass","Pass","ClipSpace","convolution","ConvolutionPass","KERNEL","gl","props","Object","assign","id","swap","kernel","NORMAL","clipspace","modules","fs","setProps","setUniforms","uKernel","uKernelWeight","reduce","sum","x","inputBuffer","outputBuffer","width","height","draw","uniforms","tDiffuse","uTextureSize","parameters","depthWrite","depthTest"],"mappings":";;;;;AAGA,SAAQA,KAAK,IAAIC,IAAjB,EAAuBC,SAAvB,QAAuC,eAAvC;AACA,OAAOC,WAAP,MAAwB,wBAAxB;;IAEqBC,e;;;;;wBACC;AAClB,aAAOD,WAAW,CAACE,MAAnB;AACD;;;AAED,2BAAYC,EAAZ,EAA4B;AAAA;;AAAA,QAAZC,KAAY,uEAAJ,EAAI;;AAAA;;AAC1B,yFACED,EADF,EAEEE,MAAM,CAACC,MAAP,CACE;AACEC,MAAAA,EAAE,EAAE,kBADN;AAEEC,MAAAA,IAAI,EAAE,IAFR;AAGEC,MAAAA,MAAM,EAAET,WAAW,CAACE,MAAZ,CAAmBQ;AAH7B,KADF,EAMEN,KANF,CAFF;AAYA,UAAKO,SAAL,GAAiB,IAAIZ,SAAJ,CAAcI,EAAd,EAAkB;AACjCI,MAAAA,EAAE,EAAE,kBAD6B;AAEjCK,MAAAA,OAAO,EAAE,CAACZ,WAAD,CAFwB;AAGjCa,MAAAA,EAAE;AAH+B,KAAlB,CAAjB;;AAYA,UAAKC,QAAL,CAAcV,KAAd;;AAzB0B;AA0B3B;;;;6BAEQA,K,EAAO;AACdC,MAAAA,MAAM,CAACC,MAAP,CAAc,KAAKF,KAAnB,EAA0BA,KAA1B;AACA,WAAKO,SAAL,CAAeI,WAAf,CAA2B;AACzBC,QAAAA,OAAO,EAAE,KAAKZ,KAAL,CAAWK,MADK;AAEzBQ,QAAAA,aAAa,EAAE,KAAKb,KAAL,CAAWK,MAAX,CAAkBS,MAAlB,CAAyB,UAACC,GAAD,EAAMC,CAAN;AAAA,iBAAYD,GAAG,GAAGC,CAAlB;AAAA,SAAzB,EAA8C,CAA9C;AAFU,OAA3B;AAID;;;sCAEwC;AAAA,UAA5BC,WAA4B,QAA5BA,WAA4B;AAAA,UAAfC,YAAe,QAAfA,YAAe;AAAA,UAChCC,KADgC,GACfF,WADe,CAChCE,KADgC;AAAA,UACzBC,MADyB,GACfH,WADe,CACzBG,MADyB;AAEvC,WAAKb,SAAL,CAAec,IAAf,CAAoB;AAClBC,QAAAA,QAAQ,EAAE;AACRC,UAAAA,QAAQ,EAAEN,WADF;AAERO,UAAAA,YAAY,EAAE,CAACL,KAAD,EAAQC,MAAR;AAFN,SADQ;AAKlBK,QAAAA,UAAU,EAAE;AACVC,UAAAA,UAAU,EAAE,KADF;AAEVC,UAAAA,SAAS,EAAE;AAFD;AALM,OAApB;AAUD;;;;EArD0CjC,I;;SAAxBG,e","sourcesContent":["// A convolution render pass\n// Based on https://webglfundamentals.org/webgl/lessons/webgl-image-processing-continued.html\n\nimport {_Pass as Pass, ClipSpace} from '@luma.gl/core';\nimport convolution from '../modules/convolution';\n\nexport default class ConvolutionPass extends Pass {\n  static get KERNEL() {\n    return convolution.KERNEL;\n  }\n\n  constructor(gl, props = {}) {\n    super(\n      gl,\n      Object.assign(\n        {\n          id: 'convolution-pass',\n          swap: true,\n          kernel: convolution.KERNEL.NORMAL\n        },\n        props\n      )\n    );\n\n    this.clipspace = new ClipSpace(gl, {\n      id: 'convolution-pass',\n      modules: [convolution],\n      fs: `\n        uniform sampler2D tDiffuse;\n        varying vec2 uv; // the texCoords passed in from the vertex shader.\n        void main() {\n          gl_FragColor = convolution_getColor(tDiffuse, uv);\n        }\n      `\n    });\n\n    this.setProps(props);\n  }\n\n  setProps(props) {\n    Object.assign(this.props, props);\n    this.clipspace.setUniforms({\n      uKernel: this.props.kernel,\n      uKernelWeight: this.props.kernel.reduce((sum, x) => sum + x, 0)\n    });\n  }\n\n  _renderPass({inputBuffer, outputBuffer}) {\n    const {width, height} = inputBuffer;\n    this.clipspace.draw({\n      uniforms: {\n        tDiffuse: inputBuffer,\n        uTextureSize: [width, height]\n      },\n      parameters: {\n        depthWrite: false,\n        depthTest: false\n      }\n    });\n  }\n}\n"],"file":"convolution-pass.js"}