{"version":3,"sources":["../../../src/passes/outline-pass.js"],"names":["_Pass","Pass","withParameters","setParameters","OutlinePass","gl","props","Object","assign","id","setProps","animationProps","stencilTest","stencilOp","stencilFunc","stencilMask","clear","models","model","setUniforms","normalUniforms","draw","drawParams","depthTest","outlineUniforms"],"mappings":";;;;;AAKA,SAAQA,KAAK,IAAIC,IAAjB,EAAuBC,cAAvB,EAAuCC,aAAvC,QAA2D,eAA3D;;IAEqBC,W;;;AACnB,uBAAYC,EAAZ,EAA4B;AAAA;;AAAA,QAAZC,KAAY,uEAAJ,EAAI;;AAAA;;AAC1B,qFAAMD,EAAN,EAAUE,MAAM,CAACC,MAAP,CAAc;AAACC,MAAAA,EAAE,EAAE;AAAL,KAAd,EAA2CH,KAA3C,CAAV;;AACA,UAAKI,QAAL,CAAcJ,KAAd;;AAF0B;AAG3B;;;;6BAEQA,K,EAAO;AACd,WAAKA,KAAL,GAAaC,MAAM,CAACC,MAAP,CAAc,KAAKF,KAAnB,EAA0BA,KAA1B,CAAb;AAED;;;sCAEiC;AAAA;;AAAA,UAArBD,EAAqB,QAArBA,EAAqB;AAAA,UAAjBM,cAAiB,QAAjBA,cAAiB;AAChCT,MAAAA,cAAc,CACZG,EADY,EAEZ;AACEO,QAAAA,WAAW,EAAE,IADf;AAEEC,QAAAA,SAAS,EAAE;AAFb,OAFY,EAMZ,YAAM;AAEJV,QAAAA,aAAa,CAACE,EAAD,EAAK;AAChBS,UAAAA,WAAW,EAAE,MAAY,CAAZ,EAAe,IAAf,CADG;AAEhBC,UAAAA,WAAW,EAAE;AAFG,SAAL,CAAb;AAKAV,QAAAA,EAAE,CAACW,KAAH;AAPI;AAAA;AAAA;;AAAA;AAUJ,+BAAoB,MAAI,CAACV,KAAL,CAAWW,MAA/B,8HAAuC;AAAA,gBAA5BC,KAA4B;AACrCA,YAAAA,KAAK,CAACC,WAAN,CAAkB,MAAI,CAACb,KAAL,CAAWc,cAA7B;AACAF,YAAAA,KAAK,CAACG,IAAN,CAAW,MAAI,CAACf,KAAL,CAAWgB,UAAtB;AACD;AAbG;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAgBJnB,QAAAA,aAAa,CAACE,EAAD,EAAK;AAChBS,UAAAA,WAAW,EAAE,MAAc,CAAd,EAAiB,IAAjB,CADG;AAEhBC,UAAAA,WAAW,EAAE,IAFG;AAGhBQ,UAAAA,SAAS,EAAE;AAHK,SAAL,CAAb;AAhBI;AAAA;AAAA;;AAAA;AAsBJ,gCAAoB,MAAI,CAACjB,KAAL,CAAWW,MAA/B,mIAAuC;AAAA,gBAA5BC,MAA4B;;AACrCA,YAAAA,MAAK,CAACC,WAAN,CAAkB,MAAI,CAACb,KAAL,CAAWkB,eAA7B;;AACAN,YAAAA,MAAK,CAACG,IAAN,CAAW,MAAI,CAACf,KAAL,CAAWgB,UAAtB;;AACAJ,YAAAA,MAAK,CAACC,WAAN,CAAkB,MAAI,CAACb,KAAL,CAAWc,cAA7B;AACD;AA1BG;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AA6BL,OAnCW,CAAd;AAqCD;;;;EAjDsCnB,I;;SAApBG,W","sourcesContent":["/**\n * A traditional stencil buffer based outline pass.\n */\n\nimport GL from '@luma.gl/constants';\nimport {_Pass as Pass, withParameters, setParameters} from '@luma.gl/core';\n\nexport default class OutlinePass extends Pass {\n  constructor(gl, props = {}) {\n    super(gl, Object.assign({id: 'simple-outline-pass'}, props));\n    this.setProps(props);\n  }\n\n  setProps(props) {\n    this.props = Object.assign(this.props, props);\n    // this.clipspace.setUniforms(pixelation.getUniforms(this.props));\n  }\n\n  _renderPass({gl, animationProps}) {\n    withParameters(\n      gl,\n      {\n        stencilTest: true, // turn on stencil buffers\n        stencilOp: [GL.KEEP, GL.KEEP, GL.REPLACE] // update stencil if both stencil+depth tests pass\n      },\n      () => {\n        // Enable writing to stencil buffer plane 0\n        setParameters(gl, {\n          stencilFunc: [GL.ALWAYS, 1, 0xff], // update stencil buffer, regardless of current value\n          stencilMask: 0x01\n        });\n\n        gl.clear(GL.STENCIL_BUFFER_BIT);\n\n        // draw\n        for (const model of this.props.models) {\n          model.setUniforms(this.props.normalUniforms);\n          model.draw(this.props.drawParams);\n        }\n\n        // Disable stencil writing, mask to stencil plane 0\n        setParameters(gl, {\n          stencilFunc: [GL.NOTEQUAL, 1, 0x01],\n          stencilMask: 0x00, // disable writing to the stencil buffer\n          depthTest: false\n        });\n\n        for (const model of this.props.models) {\n          model.setUniforms(this.props.outlineUniforms);\n          model.draw(this.props.drawParams);\n          model.setUniforms(this.props.normalUniforms);\n        }\n\n        // All GL settings will reset here...\n      }\n    );\n  }\n}\n"],"file":"outline-pass.js"}