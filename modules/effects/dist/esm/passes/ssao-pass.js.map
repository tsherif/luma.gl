{"version":3,"sources":["../../../src/passes/ssao-pass.js"],"names":["_Pass","Pass","Framebuffer","ClipSpace","withParameters","ssao","SSAOPass","gl","props","Object","assign","id","swap","DEFAULT_PROPS","renderToScreen","depthFramebuffer","clipspace","modules","fs","setProps","width","height","resize","setUniforms","inputBuffer","outputBuffer","animationProps","framebuffer","clear","COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","models","model","depth_uEnabled","draw","drawParams","uniforms","tDepth","tDiffuse","size"],"mappings":"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","sourcesContent":["/**\n * Screen-space ambient occlusion pass.\n *\n * Ported to luma.gl from THREE.js (MIT license).\n * Attributions (per comments in original THREE.js files):\n * @author alteredq / http://alteredqualia.com/\n * @author tentone\n */\n\n/* eslint-disable camelcase */\nimport {_Pass as Pass, Framebuffer, ClipSpace, withParameters} from '@luma.gl/core';\nimport ssao from '../modules/ssao';\n\nexport default class SSAOPass extends Pass {\n  constructor(gl, props) {\n    super(gl, Object.assign({id: 'ssao-pass', swap: true}, ssao.DEFAULT_PROPS, props));\n\n    this.renderToScreen = false;\n\n    // Depth render target, for `depth` shader module\n    this.depthFramebuffer = new Framebuffer(gl, {id: 'ssao-pass-depth-map'});\n\n    this.clipspace = new ClipSpace(gl, {\n      id: 'ssao-pass',\n      modules: [ssao],\n      fs: `\n        varying vec2 uv;\n        void main() {\n          gl_FragColor = ssao_getColor(uv);\n        }\n      `\n    });\n\n    this.setProps(props);\n  }\n\n  setProps(props) {\n    super.setProps(props);\n\n    const {width = 512, height = 512} = this.props;\n    this.depthFramebuffer.resize({width, height});\n    this.clipspace.setUniforms(this.props);\n\n    // Shader uniforms\n    // this.uniforms['cameraNear' ].value = this.camera2.near;\n    // this.uniforms[ 'cameraFar' ].value = this.camera2.far;\n  }\n\n  _renderPass({inputBuffer, outputBuffer, animationProps}) {\n    const {width, height} = inputBuffer;\n    this.depthFramebuffer.resize({width, height});\n\n    // Render depth into depthRenderTarget\n    withParameters(this.gl, {framebuffer: this.depthFramebuffer}, () => {\n      this.gl.clear(this.gl.COLOR_BUFFER_BIT | this.gl.DEPTH_BUFFER_BIT);\n      for (const model of this.props.models) {\n        model.setUniforms({depth_uEnabled: true});\n        model.draw(Object.assign({}, this.props.drawParams, {animationProps}));\n        model.setUniforms({depth_uEnabled: false});\n      }\n    });\n\n    this.gl.clear(this.gl.COLOR_BUFFER_BIT | this.gl.DEPTH_BUFFER_BIT);\n    this.clipspace.draw({\n      animationProps,\n      uniforms: {\n        tDepth: this.depthFramebuffer,\n        tDiffuse: inputBuffer,\n        size: [this.depthFramebuffer.width, this.depthFramebuffer.height]\n      }\n    });\n  }\n}\n"],"file":"ssao-pass.js"}