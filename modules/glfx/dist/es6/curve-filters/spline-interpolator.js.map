{"version":3,"sources":["../../../src/curve-filters/spline-interpolator.js"],"names":["SplineInterpolator","constructor","points","n","length","xa","ya","u","y2","sort","a","b","i","push","wx","sig","p","ddydx","interpolate","x","klo","khi","k","h"],"mappings":"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","sourcesContent":["// from SplineInterpolator.cs in the Paint.NET source code\n\nexport default class SplineInterpolator {\n  constructor(points) {\n    const n = points.length;\n    this.xa = [];\n    this.ya = [];\n    this.u = [];\n    this.y2 = [];\n\n    points.sort((a, b) => a[0] - b[0]);\n\n    for (let i = 0; i < n; i++) {\n      this.xa.push(points[i][0]);\n      this.ya.push(points[i][1]);\n    }\n\n    this.u[0] = 0;\n    this.y2[0] = 0;\n\n    for (let i = 1; i < n - 1; ++i) {\n      // This is the decomposition loop of the tridiagonal algorithm.\n      // y2 and u are used for temporary storage of the decomposed factors.\n      const wx = this.xa[i + 1] - this.xa[i - 1];\n      const sig = (this.xa[i] - this.xa[i - 1]) / wx;\n      const p = sig * this.y2[i - 1] + 2.0;\n\n      this.y2[i] = (sig - 1.0) / p;\n\n      const ddydx =\n        (this.ya[i + 1] - this.ya[i]) / (this.xa[i + 1] - this.xa[i]) -\n        (this.ya[i] - this.ya[i - 1]) / (this.xa[i] - this.xa[i - 1]);\n\n      this.u[i] = ((6.0 * ddydx) / wx - sig * this.u[i - 1]) / p;\n    }\n\n    this.y2[n - 1] = 0;\n\n    // This is the backsubstitution loop of the tridiagonal algorithm\n    for (let i = n - 2; i >= 0; --i) {\n      this.y2[i] = this.y2[i] * this.y2[i + 1] + this.u[i];\n    }\n  }\n\n  interpolate(x) {\n    const n = this.ya.length;\n    let klo = 0;\n    let khi = n - 1;\n\n    // We will find the right place in the table by means of\n    // bisection. This is optimal if sequential calls to this\n    // routine are at random values of x. If sequential calls\n    // are in order, and closely spaced, one would do better\n    // to store previous values of klo and khi.\n    while (khi - klo > 1) {\n      const k = (khi + klo) >> 1;\n\n      if (this.xa[k] > x) {\n        khi = k;\n      } else {\n        klo = k;\n      }\n    }\n\n    const h = this.xa[khi] - this.xa[klo];\n    const a = (this.xa[khi] - x) / h;\n    const b = (x - this.xa[klo]) / h;\n\n    // Cubic spline polynomial is now evaluated.\n    return (\n      a * this.ya[klo] +\n      b * this.ya[khi] +\n      (((a * a * a - a) * this.y2[klo] + (b * b * b - b) * this.y2[khi]) * (h * h)) / 6.0\n    );\n  }\n}\n"],"file":"spline-interpolator.js"}