!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e(require("luma"));else if("function"==typeof define&&define.amd)define(["luma"],e);else{var n="object"==typeof exports?e(require("luma")):e(t.luma);for(var i in n)("object"==typeof exports?exports:t)[i]=n[i]}}(window,function(t){return function(t){var e={};function n(i){if(e[i])return e[i].exports;var s=e[i]={i:i,l:!1,exports:{}};return t[i].call(s.exports,s,s.exports,n),s.l=!0,s.exports}return n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)n.d(i,s,function(e){return t[e]}.bind(null,s));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=7)}([function(t,e,n){"use strict";function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function s(t){return(s="function"==typeof Symbol&&"symbol"===i(Symbol.iterator)?function(t){return i(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":i(t)})(t)}n.d(e,"a",function(){return s})},function(t,e,n){"use strict";(function(t,i){n.d(e,"b",function(){return r}),n.d(e,"a",function(){return a});var s=n(0),o={self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:void 0!==t&&t,document:"undefined"!=typeof document&&document,process:"object"===(void 0===i?"undefined":Object(s.a)(i))&&i},r=o.window||o.self||o.global,a=o.process||{};console}).call(this,n(4),n(3))},function(e,n){e.exports=t},function(t,e){var n,i,s=t.exports={};function o(){throw new Error("setTimeout has not been defined")}function r(){throw new Error("clearTimeout has not been defined")}function a(t){if(n===setTimeout)return setTimeout(t,0);if((n===o||!n)&&setTimeout)return n=setTimeout,setTimeout(t,0);try{return n(t,0)}catch(e){try{return n.call(null,t,0)}catch(e){return n.call(this,t,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:o}catch(t){n=o}try{i="function"==typeof clearTimeout?clearTimeout:r}catch(t){i=r}}();var u,c=[],f=!1,l=-1;function h(){f&&u&&(f=!1,u.length?c=u.concat(c):l=-1,c.length&&d())}function d(){if(!f){var t=a(h);f=!0;for(var e=c.length;e;){for(u=c,c=[];++l<e;)u&&u[l].run();l=-1,e=c.length}u=null,f=!1,function(t){if(i===clearTimeout)return clearTimeout(t);if((i===r||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(t);try{i(t)}catch(e){try{return i.call(null,t)}catch(e){return i.call(this,t)}}}(t)}}function m(t,e){this.fun=t,this.array=e}function p(){}s.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];c.push(new m(t,e)),1!==c.length||f||a(d)},m.prototype.run=function(){this.fun.apply(null,this.array)},s.title="browser",s.browser=!0,s.env={},s.argv=[],s.version="",s.versions={},s.on=p,s.addListener=p,s.once=p,s.off=p,s.removeListener=p,s.removeAllListeners=p,s.emit=p,s.prependListener=p,s.prependOnceListener=p,s.listeners=function(t){return[]},s.binding=function(t){throw new Error("process.binding is not supported")},s.cwd=function(){return"/"},s.chdir=function(t){throw new Error("process.chdir is not supported")},s.umask=function(){return 0}},function(t,e){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(t){"object"==typeof window&&(n=window)}t.exports=n},function(t,e,n){"use strict";(function(t){n.d(e,"a",function(){return o});var i=n(0),s=n(6);function o(){return!("object"===(void 0===t?"undefined":Object(i.a)(t))&&"[object process]"===String(t)&&!t.browser)||Object(s.a)()}}).call(this,n(3))},function(t,e,n){"use strict";(function(t){n.d(e,"a",function(){return s});var i=n(0);function s(e){if("undefined"!=typeof window&&"object"===Object(i.a)(window.process)&&"renderer"===window.process.type)return!0;if(void 0!==t&&"object"===Object(i.a)(t.versions)&&Boolean(t.versions.electron))return!0;var n="object"===("undefined"==typeof navigator?"undefined":Object(i.a)(navigator))&&"string"==typeof navigator.userAgent&&navigator.userAgent,s=e||n;return!!(s&&s.indexOf("Electron")>=0)}}).call(this,n(3))},function(t,e,n){(function(e){const i=n(8),s="undefined"==typeof window?e:window;s.loaders=s.luma||{},t.exports=Object.assign(s.luma,i)}).call(this,n(4))},function(t,e,n){"use strict";n.r(e);var i=n(2);function s(){}const o={name:"Unnamed test",onInitialize:s,onRender:({done:t})=>t(),onFinalize:s},r={onTestStart:t=>console.log(`# ${t.name}`),onTestPass:t=>console.log(`ok ${t.name} passed`),onTestFail:t=>console.log(`not ok ${t.name} failed`),timeout:2e3};class a{constructor(t={}){this.props=t,this.isRunning=!1,this._testCases=[],this._testCaseData=null,this.isHeadless=Boolean(window.browserTestDriver_isHeadless),this.testOptions=Object.assign({},r)}add(t){Array.isArray(t)||(t=[t]);for(const e of t)this._testCases.push(e);return this}run(t={}){return Object.assign(this.testOptions,t),new Promise(t=>{this._animationLoop=new i.AnimationLoop(Object.assign({},this.props,{onRender:this._onRender.bind(this),onFinalize:()=>{this.isRunning=!1,t()}})),this._animationLoop.start(this.props),this.isRunning=!0,this.isDiffing=!1,this._currentTestCase=null}).catch(t=>{this._fail({error:t.message})})}initTestCase(t){const{animationLoop:e}=t;e&&(t.onInitialize=e.onInitialize.bind(e),t.onRender=e.onRender.bind(e),t.onFinalize=e.onFinalize.bind(e));for(const e in o)t[e]=t[e]||o[e]}shouldRender(t){return!0}assert(t){this._pass(t),this._next()}_pass(t){this.testOptions.onTestPass(this._currentTestCase,t)}_fail(t){this.testOptions.onTestFail(this._currentTestCase,t)}_next(){this._nextTestCase()}_onRender(t){this._animationProps=t;const e=this._currentTestCase||this._nextTestCase();if(!e)return void this._animationLoop.stop();let n=!1;const i=Object.assign({},t,this._testCaseData,{startTime:this._currentTestCaseStartTime,time:t.time-this._currentTestCaseStartTime,tick:t.tick-this._currentTestCaseStartTick,done:()=>{n=!0}});this._testCaseData&&this.shouldRender(i)&&e.onRender(i);const s=e.timeout||this.testOptions.timeout;s&&i.time>s&&(n=!0),n&&this.assert(e)}_nextTestCase(){const t=this._animationProps;if(this._testCaseData){for(const t in this._testCaseData){const e=this._testCaseData[t];e&&e.delete&&e.delete()}this._currentTestCase.onFinalize(Object.assign({},t,this._testCaseData)),Object(i.popContextState)(t.gl),this._currentTestCase=null,this._testCaseData=null}const e=this._testCases.shift();return e&&(this._currentTestCase=e,this._currentTestCaseStartTime=t.time,this._currentTestCaseStartTick=t.tick,this.initTestCase(e),Object(i.pushContextState)(t.gl),Promise.resolve(e.onInitialize(Object.assign({},t,{startTime:t.time,time:0,tick:0}))).then(t=>{this._testCaseData=t||{}}),this.testOptions.onTestStart(e)),e}}function u(t){const e=t.getBoundingClientRect();return{x:window.scrollX+e.x,y:window.scrollY+e.y,width:e.width,height:e.height}}class c extends a{constructor(t){super(t),Object.assign(this.testOptions,{imageDiffOptions:{}})}initTestCase(t){if(super.initTestCase(t),!t.goldenImage)throw new Error(`Test case ${t.name} does not have golden image`)}shouldRender(){return!this.isDiffing}assert(t){if(this.isDiffing)return;this.isDiffing=!0;const e=Object.assign({},this.testOptions.imageDiffOptions,t.imageDiffOptions,{goldenImage:t.goldenImage,region:u(this._animationProps.canvas)});window.browserTestDriver_captureAndDiffScreen(e).then(t=>{t.success?this._pass(t):this._fail(t),this.isDiffing=!1,this._next()})}}function f(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function l(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function h(t,e,n){return e&&l(t.prototype,e),n&&l(t,n),t}var d=n(5),m=Object(d.a)(),p=n(1);function g(){var t;if(m&&p.b.performance)t=p.b.performance.now();else if(p.a.hrtime){var e=p.a.hrtime();t=1e3*e[0]+e[1]/1e6}else t=Date.now();return t}var y=function(){function t(e){f(this,t),this.name=e,this.reset()}return h(t,[{key:"incrementCount",value:function(){this.addCount(1)}},{key:"decrementCount",value:function(){this.subtractCount(1)}},{key:"addCount",value:function(t){this.count+=t}},{key:"subtractCount",value:function(t){this.count-=t}},{key:"addTime",value:function(t){this.time+=t,this.lastTiming=t,this.count++}},{key:"timeStart",value:function(){this._startTime=g(),this._timerPending=!0}},{key:"timeEnd",value:function(){this._timerPending&&(this.addTime(g()-this._startTime),this._timerPending=!1)}},{key:"getAverageTime",value:function(){return this.count>0?this.time/this.count:0}},{key:"getHz",value:function(){return this.time>0?this.count/(this.time/1e3):0}},{key:"reset",value:function(){this.time=0,this.count=0,this.lastTiming=0,this._startTime=0,this._timerPending=!1}}]),t}(),b=function(){function t(e){var n=e.id;f(this,t),this.id=n,this.stats={},Object.seal(this)}return h(t,[{key:"get",value:function(t){return this.stats[t]=this.stats[t]||new y(t),this.stats[t]}},{key:"reset",value:function(){for(var t in this.stats)this.stats[t].reset();return this}},{key:"forEach",value:function(t){for(var e in this.stats)t(this.stats[e])}},{key:"getTable",value:function(){var t={};return this.forEach(function(e){t[e.name]={time:e.time||0,count:e.count||0,average:e.getAverageTime()||0,hz:e.getHz()||0}}),t}}]),t}();class v extends a{constructor(t){super(t),Object.assign(this.testOptions,{maxFramesToRender:60,targetFPS:50})}initTestCase(t){super.initTestCase(t),this._stats=new b({id:t.name}),this._fps=this._stats.get("fps")}shouldRender(t){return this._fps.timeEnd(),this._fps.timeStart(),this._fps.count>this.testOptions.maxFramesToRender&&t.done(),!0}assert(t){const e=t.targetFPS||this.testOptions.targetFPS,n=this._fps.count,i=this._fps.getHz();i>=e?this._pass({fps:i,framesRendered:n}):this._fail({fps:i,framesRendered:n}),this._next()}}n.d(e,"SnapshotTestRunner",function(){return c}),n.d(e,"PerformanceTestRunner",function(){return v})}])});