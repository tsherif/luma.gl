{"expireTime":9007200809748943000,"key":"transformer-remark-markdown-html-fe3abc141212bf590ae9288707d959dd-gatsby-remark-imagesgatsby-remark-responsive-iframegatsby-remark-prismjsgatsby-remark-copy-linked-filesgatsby-remark-autolink-headers-","val":"<h1 id=\"transform-feedback-webgl2\"><a href=\"#transform-feedback-webgl2\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Transform Feedback (WebGL2)</h1>\n<p>Transform Feedback operations represent a GPGPU/GPU compute technique where GPU draw calls are configured so that they write some specified outputs from the vertex shaders to (one or more) GPU memory buffers that have been provided by the application. Applications use transform feedback to data processing from CPU to GPU, where multiple parallel execution units will be used for processing. Data is handled in form of <code class=\"language-text\">Buffer</code> objects, i.e. data resides in the GPU memory.</p>\n<p>Transform Feedback operations write their output into <code class=\"language-text\">Buffer</code> instances. These buffers can then be directly set as attributes on <code class=\"language-text\">Model</code> or <code class=\"language-text\">VertexArray</code> for regular rendering operations.</p>\n<p>Buffers can be read back to the CPU, but this has a high performance penaltyh. Ideally, the application's logic can be designed so that CPU access is not required which avoids expensive CPU and GPU sync.</p>\n<p>To run a single transform feedback operation:</p>\n<ul>\n<li>Create a <code class=\"language-text\">Program</code> or a <code class=\"language-text\">Model</code> with varyings (<code class=\"language-text\">out</code> variables) declared in the vertex shader's GLSL code, and provide the names of these varyings to the <code class=\"language-text\">Program</code> constructor.</li>\n<li>Use <code class=\"language-text\">Program.draw()</code> or <code class=\"language-text\">Model.draw()</code> with a <code class=\"language-text\">transformFeedback</code> parameter.</li>\n<li><code class=\"language-text\">Model.transform()</code> is equivalent to <code class=\"language-text\">Model.draw()</code> but automatically turns off the fragment shader stage.</li>\n</ul>\n<p>Alternatively, the more powerful <code class=\"language-text\">Transform</code> class is preferable if you don't want to deal with setting up <code class=\"language-text\">Program</code> and <code class=\"language-text\">TransformFeedback</code> instances, or if intend to run a repeating, double buffered transform feedback loop.</p>\n<h2 id=\"usage\"><a href=\"#usage\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Usage</h2>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span>Transform<span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@luma.gl/core'</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h3 id=\"use-case--specify-source-and-destination-buffers\"><a href=\"#use-case--specify-source-and-destination-buffers\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Use case : Specify source and destination buffers.</h3>\n<p>Create a <code class=\"language-text\">Transform</code> object by passing, vs (vertex shader), source buffer(s), varyings (output variable names in vertex shader) and destination buffers. Then call <code class=\"language-text\">run</code> to perform one transform feedback iteration.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token constant\">VS</span> <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token string\">`\\\n#version 300 es\nattribute float inValue;\nvarying float outValue;\n\nvoid main()\n{\n  outValue = 2.0 * inValue;\n}\n`</span></span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> sourceData <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Float32Array</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token number\">10</span><span class=\"token punctuation\">,</span> <span class=\"token number\">20</span><span class=\"token punctuation\">,</span> <span class=\"token number\">31</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token number\">57</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> sourceBuffer <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Buffer</span><span class=\"token punctuation\">(</span>gl<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>data<span class=\"token punctuation\">:</span> sourceData<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Default values applied for size (1) and type (gl.FLOAT)</span>\n<span class=\"token keyword\">const</span> feedbackBuffer <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Buffer</span><span class=\"token punctuation\">(</span>gl<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>byteLength<span class=\"token punctuation\">:</span> sourceData<span class=\"token punctuation\">.</span>length <span class=\"token operator\">*</span> <span class=\"token number\">4</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> transform <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Transform</span><span class=\"token punctuation\">(</span>gl2<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n  sourceBuffers<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n    inValue<span class=\"token punctuation\">:</span> sourceBuffer\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  feedbackBuffers<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n    outValue<span class=\"token punctuation\">:</span> feedbackBuffer\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  vs<span class=\"token punctuation\">:</span> <span class=\"token constant\">VS</span><span class=\"token punctuation\">,</span>\n  varyings<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'outValue'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  elementCount<span class=\"token punctuation\">:</span> <span class=\"token number\">5</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Perform one transform feedback iteration</span>\ntransform<span class=\"token punctuation\">.</span><span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h3 id=\"use-case--create-destination-buffers-automatically\"><a href=\"#use-case--create-destination-buffers-automatically\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Use case : Create destination buffers automatically.</h3>\n<p><code class=\"language-text\">Transform</code> can internally create destination buffers (i.e. feedback buffers), when <code class=\"language-text\">feedbackMap</code> is provided. Each destination buffer is created with same settings and layout as corresponding source buffer as per <code class=\"language-text\">feedbackMap</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> transform <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Transform</span><span class=\"token punctuation\">(</span>gl2<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n  sourceBuffers<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n    inValue<span class=\"token punctuation\">:</span> sourceBuffer\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  feedbackMap<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n    inValue<span class=\"token punctuation\">:</span> <span class=\"token string\">'outValue'</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  vs<span class=\"token punctuation\">:</span> <span class=\"token constant\">VS</span><span class=\"token punctuation\">,</span>\n  varyings<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'outValue'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  elementCount<span class=\"token punctuation\">:</span> <span class=\"token number\">5</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h3 id=\"use-case--multiple-iterations-using-swap\"><a href=\"#use-case--multiple-iterations-using-swap\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Use case : Multiple iterations using swap().</h3>\n<p>When <code class=\"language-text\">feedbackMap</code> is specified buffers can be swapped using a single call to <code class=\"language-text\">swap()</code>, this is useful for cases like particle simulation, where output of one transform feedback iteration is piped as input to the next iteration.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// Setup Transform with `souceDestinationMap` as above</span>\n\ntransform<span class=\"token punctuation\">.</span><span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">let</span> bufferWithNewValues <span class=\"token operator\">=</span> transform<span class=\"token punctuation\">.</span><span class=\"token function\">getBuffer</span><span class=\"token punctuation\">(</span><span class=\"token string\">'outValue'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token operator\">...</span>\n<span class=\"token comment\">// Render using 'bufferWithNewValues'</span>\n<span class=\"token operator\">...</span>\n\n<span class=\"token comment\">//swap buffers</span>\ntransform<span class=\"token punctuation\">.</span><span class=\"token function\">swap</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\ntransform<span class=\"token punctuation\">.</span><span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nbufferWithNewValues <span class=\"token operator\">=</span> transform<span class=\"token punctuation\">.</span><span class=\"token function\">getBuffer</span><span class=\"token punctuation\">(</span><span class=\"token string\">'outValue'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token operator\">...</span>\n<span class=\"token comment\">// Render using 'bufferWithNewValues'</span>\n<span class=\"token operator\">...</span></code></pre></div>\n<h3 id=\"use-case--update-one-or-more-buffers-using-update-method\"><a href=\"#use-case--update-one-or-more-buffers-using-update-method\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Use case : Update one or more buffers using update() method..</h3>\n<p>Once <code class=\"language-text\">Transform</code> object is constructed and used, one or more source or destination buffers can be updated using <code class=\"language-text\">update</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// transform is set up as above</span>\n<span class=\"token operator\">...</span>\n\n<span class=\"token comment\">// update buffer binding for 'inValue' attribute</span>\n<span class=\"token keyword\">const</span> newSourceBuffer <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Buffer</span><span class=\"token punctuation\">(</span>gl<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>data<span class=\"token punctuation\">:</span> newSourceData<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\ntransform<span class=\"token punctuation\">.</span><span class=\"token function\">update</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  sourceBuffers<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n    inValue<span class=\"token punctuation\">:</span> newSourceBuffer\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// now data is provided from newly bound buffer.</span>\ntransform<span class=\"token punctuation\">.</span><span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>"}