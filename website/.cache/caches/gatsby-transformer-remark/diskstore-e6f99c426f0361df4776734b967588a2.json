{"expireTime":9007200809748944000,"key":"transformer-remark-markdown-html-ed8fc7a1b6d2261bc0f44eaa2a099ed7-gatsby-remark-imagesgatsby-remark-responsive-iframegatsby-remark-prismjsgatsby-remark-copy-linked-filesgatsby-remark-autolink-headers-","val":"<h1 id=\"snapshottestrunner\"><a href=\"#snapshottestrunner\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>SnapshotTestRunner</h1>\n<p>Client-side utility for browser-based WebGL render tests.</p>\n<p>This class is intended to be used with <code class=\"language-text\">BrowserTestDriver</code> from <code class=\"language-text\">@probe.gl/test-utils</code>. Together they support the following workflow:</p>\n<ul>\n<li>Launch a Puppeteer instance (headless or non-headless) to run a test application</li>\n<li>In the test application, create a canvas and <code class=\"language-text\">WebGLContext</code>.</li>\n<li>For each test case, render something to the <code class=\"language-text\">WebGLContext</code>, take a screenshot, and perform pixel-diffing with a pre-defined \"golden image\". Report the matching result.</li>\n<li>Proceed to the next test case until done.</li>\n</ul>\n<h2 id=\"example\"><a href=\"#example\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Example</h2>\n<p>In your node.js start script:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// This is the script that runs in Node.js and starts the browser</span>\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span>BrowserTestDriver<span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'@probe.gl/test-utils'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">new</span> <span class=\"token class-name\">BrowserTestDriver</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  server<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Bundles and serves the browser script</span>\n    command<span class=\"token punctuation\">:</span> <span class=\"token string\">'webpack-dev-server'</span><span class=\"token punctuation\">,</span>\n    arguments<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'--env.render-test'</span><span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  headless<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>In your script that is run on the browser:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span>SnapshotTestRunner<span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'@luma.gl/test-utils'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span>Cube<span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'@luma.gl/core'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token constant\">TEST_CASES</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n  <span class=\"token punctuation\">{</span>\n    name<span class=\"token punctuation\">:</span> <span class=\"token string\">'Render A Cube'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token comment\">// `onRender` receives animation props from the AnimationLoop</span>\n    <span class=\"token function-variable function\">onRender</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span>gl<span class=\"token punctuation\">,</span> done<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">const</span> model <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Cube</span><span class=\"token punctuation\">(</span>gl<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      model<span class=\"token punctuation\">.</span><span class=\"token function\">draw</span><span class=\"token punctuation\">(</span><span class=\"token operator\">...</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token comment\">// ready for capture and diffing</span>\n      <span class=\"token function\">done</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    goldenImage<span class=\"token punctuation\">:</span> <span class=\"token string\">'./test/render/golden-images/cube.png'</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">new</span> <span class=\"token class-name\">TestRender</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>width<span class=\"token punctuation\">:</span> <span class=\"token number\">800</span><span class=\"token punctuation\">,</span> height<span class=\"token punctuation\">:</span> <span class=\"token number\">600</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token constant\">TEST_CASES</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    onTestFail<span class=\"token punctuation\">:</span> window<span class=\"token punctuation\">.</span>browserTestDriver_fail\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span>window<span class=\"token punctuation\">.</span>browserTestDriver_finish<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2 id=\"methods\"><a href=\"#methods\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Methods</h2>\n<h3 id=\"constructorprops-object\"><a href=\"#constructorprops-object\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>constructor(props: Object)</h3>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">new SnapshotTestRunner(props)</code></pre></div>\n<p>Create a SnapshotTestRunner instance. The <code class=\"language-text\">props</code> argument is forwarded to the <a href=\"/docs/api-reference/core/animation-loop.md\">AnimationLoop</a> constructor.</p>\n<h3 id=\"addtestcase-arrayobject\"><a href=\"#addtestcase-arrayobject\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>add(testCase: Array|Object)</h3>\n<p>Add one or a list of test cases. Each test case may contain the following fields:</p>\n<ul>\n<li><code class=\"language-text\">name</code> (String) - name of the test case.</li>\n<li><code class=\"language-text\">goldenImage</code> (String) - path to the golden image, relative to the root where the node script is executed.</li>\n<li><code class=\"language-text\">timeout</code> (Number) - time to wait for this test case to resolve (by calling the <code class=\"language-text\">done</code> callback) before aborting, in milliseconds. If not provided, fallback to the shared option that is passed to <code class=\"language-text\">SnapshotTestRunner.run</code>.</li>\n<li><code class=\"language-text\">imageDiffOptions</code> (Object) - image diffing options for this test case. See \"Image Diff Options\" section below.</li>\n<li><code class=\"language-text\">onInitialize</code> (Function) - called once when the test case starts. Receives a single object that is the <a href=\"/docs/api-reference/core/animation-loop.md#callback-parameters\">AnimationLoop callback parameters</a>. If this callback returns an object or a promise, the content that it resolves to will be passed to <code class=\"language-text\">onRender</code> and <code class=\"language-text\">onFinalize</code> later.</li>\n<li>\n<p><code class=\"language-text\">onRender</code> (Function) - called every animation frame when the test case is running. Receives a single object that is the <a href=\"/docs/api-reference/core/animation-loop.md#callback-parameters\">AnimationLoop callback parameters</a>, plus the following:</p>\n<ul>\n<li><code class=\"language-text\">done</code> (Function) - must be called when the test case is done rendering and ready for screen capture and comparison.</li>\n</ul>\n</li>\n<li><code class=\"language-text\">onFinalize</code> (Function) - called once when the test case is done to finalize all resources. Receives a single object that is the <a href=\"/docs/api-reference/core/animation-loop.md#callback-parameters\">AnimationLoop callback parameters</a>.</li>\n</ul>\n<h3 id=\"runoptions-object\"><a href=\"#runoptions-object\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>run(options: Object)</h3>\n<p>Run all test cases.</p>\n<p>Options:</p>\n<ul>\n<li><code class=\"language-text\">timeout</code> (Number) - time to wait for each test case to resolve (by calling the <code class=\"language-text\">done</code> callback) before aborting, in milliseconds. Default <code class=\"language-text\">2000</code>.</li>\n<li><code class=\"language-text\">imageDiffOptions</code> (Object) - image diffing options for all test cases. This will be overridden if a test case defines its own <code class=\"language-text\">imageDiffOptions</code>. See \"Image Diff Options\" section below.</li>\n<li><code class=\"language-text\">onTestStart</code> (Function) - callback when a test starts. Receives the current test case. Default logs the test name to console.</li>\n<li><code class=\"language-text\">onTestPass</code> (Function) - callback when a test passes. Receives the current test case and the diffing result. Default logs the pixel matching percentage to console.</li>\n<li><code class=\"language-text\">onTestFail</code> (Function) - callback when a test fails, either because the matching rate is below threshold or a critical error. Receives the current test case. Default logs the error message or the pixel matching percentage to console.</li>\n</ul>\n<p>Returns: a <code class=\"language-text\">Promise</code> that resolves when all test cases are done.</p>\n<h2 id=\"members\"><a href=\"#members\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Members</h2>\n<h3 id=\"isheadless\"><a href=\"#isheadless\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>isHeadless</h3>\n<p>Whether the test is being run in headless mode. In headless mode, Chromium uses software render which behaves slightly differently from non-headless. Image diffing tolerance may need to be adjusted accordingly.</p>\n<h2 id=\"image-diff-options\"><a href=\"#image-diff-options\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Image Diff Options</h2>\n<p>The test renderer and each test case may choose to override the default image diffing options. The following options from <a href=\"https://github.com/uber-web/probe.gl/blob/master/docs/api-reference/test-utils/browser-test-driver.md#browsertestdriver_captureanddiffscreenoptions--object\">captureAndDiffScreen</a> are supported:</p>\n<ul>\n<li><code class=\"language-text\">tolerance</code></li>\n<li><code class=\"language-text\">threshold</code></li>\n<li><code class=\"language-text\">includeAA</code></li>\n<li><code class=\"language-text\">createDiffImage</code></li>\n<li><code class=\"language-text\">saveOnFail</code></li>\n<li><code class=\"language-text\">saveAs</code></li>\n</ul>"}